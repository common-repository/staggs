!function($){var pricetotal={},altpricetotal={},lastImages={},zIndex=0,minStep=1,activeStep=1,visitedStep=1,maxStep=1,shared_config={},wishlist_items=[],repeater_items={},sgg_canvasses={};function _initializeRepeater(t,e=[]){var i=[],a=t.find("[data-repeater-list]").data("repeater-list");e.length&&e.forEach(function(t,e){if(t.id&&-1!==t.id.indexOf(a)){var n=t.id.split("["),o=n[1].replace("]",""),s=n[2].replace("]",""),r=urldecode(t.value);i[o]?i[o][s]=r:i[o]={[s]:r}}});var n=t.repeater({initEmpty:!0,min:0,max:1,defaultValues:{},repeaters:[],show:function(){t.find(".repeater-empty-note").hide(),$(this).parents("[data-repeater-list]").find("[data-repeater-item]").each(function(t,e){$(e).find(".index").text(t+1)}),activateConditionalStepFields($(this)),$(this).find(".option-group-options").each(function(t,e){var i="";i=$(e).find("input").length?$(e).find("input").attr("name"):$(e).find("select").attr("name"),setActiveStepOptions($(e),i,"id")}),$(this).slideDown()},hide:function(t){confirm("Are you sure you want to delete this item?")&&$(this).slideUp(t,function(){$(".staggs-view-gallery .swiper-slide").length&&$(this).find(".option-group").each(function(t,e){var i=$(e).find("input").attr("name");i||(i=$(e).find("select").attr("name")),i=i.replaceAll("[","_").replaceAll("]",""),$(e).find(".option-group-options").hasClass("tickboxes")?$(e).find("input").each(function(t,e){var i=$(e).attr("id");i=i.replaceAll("[","_").replaceAll("]",""),$(".staggs-view-gallery .swiper-slide").each(function(t,e){$(e).find('img[id="preview_'+t+"_"+i+'"]').length&&$(e).find('img[id="preview_'+t+"_"+i+'"]').remove()})}):$(".staggs-view-gallery .swiper-slide").each(function(t,e){$(e).find('img[id="preview_'+t+"_"+i+'"]').length&&$(e).find('img[id="preview_'+t+"_"+i+'"]').remove()})}),$(t).remove(),1==$(this).parents("[data-repeater-list]").find("[data-repeater-item]").length?$(".repeater-empty-note").show():$(this).parents("[data-repeater-list]").find("[data-repeater-item]:visible").each(function(t,e){$(e).find(".index").text(t+1)}),$(".staggs-summary-widget").length&&setTimeout(function(){_updateSummary()},200)})}});i.length>0&&(n.setList(i),t.find(".repeater-empty-note").hide(),n.find(".option-group-options").each((t,e)=>{setActiveStepOptions($(e))})),repeater_items[a]=n}function _emptyRepeater(t){var e=repeater_items[t.find("[data-repeater-list]").data("repeater-list")];e&&e.setList([]),t.find(".repeater-empty-note").show()}function _setActiveStep(){if(!$(".staggs-step-prev-button").length&&!$(".staggs-step-next-button").length){$('.option-group.total[data-show-step="final"]').length&&$('.option-group.total[data-show-step="final"]').removeClass("hidden");return}activeStep>=minStep&&activeStep<=maxStep&&($(".configurator-step-link").removeClass("active"),$(".option-group-step").addClass("hidden"),$(".configurator-step-link[data-step-number="+activeStep+"]").addClass("active"),$(".option-group-step[data-step-group-id="+activeStep+"]").removeClass("hidden"),$(".option-group-step[data-step-group-id="+activeStep+"] .option-group[data-slide-preview]:not(.hidden)").each(function(t,e){var i=$(this).data("slide-preview");gallerySwiper&&_setActiveImageSlide(i)}),stepNavSwiper&&stepNavSwiper.slideTo(activeStep-1),STEPPER_DISABLE_SCROLL_TOP||($(".staggs-configurator-inline").length||$(".staggs-configurator").hasClass("has-theme-header")||$(".staggs-configurator").hasClass("has-theme-footer")?$(".staggs-product-options").scrollTop(0):$("html,body").scrollTop(0)));var t=_validateStepFields();activeStep>minStep?$(".staggs-step-prev-button").removeClass("disabled"):$(".staggs-step-prev-button").addClass("disabled"),activeStep<maxStep&&t?$(".staggs-step-next-button").removeClass("disabled"):$(".staggs-step-next-button").addClass("disabled"),_setTotalsButton(t)}function _validateStepFields(){let t=!0;return $('.option-group-step[data-step-group-id="'+activeStep+'"] .invalid').length&&(t=!1),$('.option-group-step[data-step-group-id="'+activeStep+'"] input[required], .option-group-step[data-step-group-id="'+activeStep+'"] textarea[required]').each(function(){"radio"===$(this).attr("type")?$(this).parents(".option-group-options").find("input:checked").length||(t=!1):$(this).val()||(t=!1)}),$('.option-group-step[data-step-group-id="'+activeStep+'"] select[required]').each(function(){$(this).val()||(t=!1)}),t}function _loadActiveStep(){var t=window.location.search;t&&(t.includes("configuration=")||t.includes("options=")||t.includes("staggs_summary="))&&!t.includes("preview=true")?void 0!==shared_config.progress?(activeStep=shared_config.progress.current,visitedStep=shared_config.progress.visited,maxStep=shared_config.progress.max):(t.includes("origin=wc_cart_page")&&(activeStep=$(".option-group-step").length,visitedStep=$(".option-group-step").length),maxStep=$(".option-group-step").length):maxStep=$(".option-group-step").length,_setActiveStep()}function _setActiveImageSlide(t){t&&(gallerySwiper.slideTo(t-1,!1,!1),$(".view-nav-buttons button").removeClass("selected"),$("#preview_nav_"+(t-1)).addClass("selected"),$("#preview_nav_label_"+(t-1)).addClass("selected"))}function _loadConfiguratorPopup(){var t=window.location.search;$(".staggs-configurator-popup").length&&t&&t.includes("options=")&&!t.includes("preview=true")&&($(".staggs-configurator-popup").addClass("active"),$("body").addClass("staggs-popup-active"),$(".staggs-message-wrapper").removeClass("inline")),$(".staggs-configurator-popup").length&&($(".staggs-configurator-bottom-bar .product-view-usps").length&&$(".staggs-configurator-bottom-bar .bottom-bar-left").addClass("has-usps"),$(".staggs-configurator-bottom-bar-spacer").length&&$(".staggs-configurator-bottom-bar-spacer").height($(".staggs-configurator-bottom-bar").height()))}function _validateConditionalSteps(){var t={};$("#configurator-options input, #configurator-options select").each(function(e,i){if("checkbox"===$(i).attr("type")||"radio"===$(i).attr("type"))var a=$(this).is(":checked");else var a=!!$(this).val();if($(i).find("option").length)var n=$(i).find(":selected").data("step-id"),o=$(i).find(":selected").data("option-id");else if("checkbox"===$(i).attr("type")){var n=$(i).data("step-id"),o=$(i).data("option-id");a=$(i).is(":checked")}else if("radio"===$(i).attr("type"))var n=$(i).data("step-id"),o=$(i).data("option-id");else var n=$(i).data("step-id"),o=$(i).val();n in t?a&&t[n].push(o):a?t[n]=[o]:t[n]=[]});var e=[];$(".conditional-wrapper").each(function(i,a){var n=$(a).data("step-rules"),o=$(a).data("step-id"),s=$(a).find(".option-group-content").length;if($(a).data("step-type")&&"repeater"==$(a).data("step-type"))var s=$(a).find(".staggs-repeater-main").length;if(_validateRuleset(n,t))$(a).addClass("conditional-loaded"),$(a).data("step-type")&&"repeater"==$(a).data("step-type")&&$(a).find(".staggs-repeater").removeClass("staggs-repeater-hidden"),!s&&(setConditionalStepHtml(a,sessionStorage.getItem("option-group-"+o)),activateConditionalStepFields(a),e.push(a),$(".option-group-step-toggler[data-step-group-id="+o+"]").length&&$(".option-group-step-toggler[data-step-group-id="+o+"]").removeClass("hidden"),$('.tab-list a[data-tabs*="'+o+'"]').length&&($('.tab-list a[data-tabs*="'+o+'"]').removeClass("hidden"),$("#option-group-"+o).removeClass("tab-hidden")),$('.tab-list a[data-tabs*="'+o+'"]').length&&!$('.tab-list a[data-tabs*="'+o+'"].active').length&&$("#option-group-"+o).addClass("tab-hidden"),$(a).parents(".option-group-step.collapsible.hidden").length&&$(a).parents(".option-group-step").find(".option-group").length&&($(a).parents(".option-group-step").data("step-group-id")?activeStep==$(a).parents(".option-group-step").data("step-group-id")&&$(a).parents(".option-group-step").removeClass("hidden"):$(a).parents(".option-group-step").removeClass("hidden")));else{var r=$(a).html();if(r&&sessionStorage.setItem("option-group-"+o,r),$(a).data("step-type")&&"repeater"==$(a).data("step-type"))$(a).find(".staggs-repeater-main").length&&(_emptyRepeater($(a).find(".staggs-repeater-main")),$(a).find(".staggs-repeater").addClass("staggs-repeater-hidden"));else{var p=$(a).find(".option-group").data("model");if($(a).find("select")&&$(a).find("option:first-of-type").data("preview-urls"))var l=$(a).find("option:first-of-type").data("preview-urls").replace("0|","");else if($(a).find("input")&&$(a).find("input:first-of-type").data("preview-urls"))var l=$(a).find("input:first-of-type").data("preview-urls").replace("0|","");if($(a).find("select").length&&$(a).find("option:first-of-type").data("color"))var d=$(a).find("option:first-of-type").data("color");else if($(a).find("input").length&&$(a).find("input:first-of-type").data("color"))var d=$(a).find("input:first-of-type").data("color");if($.event.trigger({type:"modelOptionsGroupRemoved",model:p,texture:l,color:d}),$(".staggs-view-gallery .swiper-slide").length){var g=$(a).find("input").attr("name");g||(g=$(a).find("select").attr("name")),$(a).find(".option-group-options input[type=checkbox]").length?$(a).find("input").each(function(t,e){var i=$(e).attr("id");$(".staggs-view-gallery .swiper-slide").each(function(t,e){$(e).find('img[id="preview_'+t+"_"+i+'"]').length&&$(e).find('img[id="preview_'+t+"_"+i+'"]').remove(),$(".staggs-view-gallery").find('img[id="button_preview_'+t+"_"+i+'"]').length&&$(".staggs-view-gallery").find('img[id="button_preview_'+t+"_"+i+'"]').remove()})}):$(".staggs-view-gallery .swiper-slide").each(function(t,e){$(e).find('img[id="preview_'+t+"_"+g+'"]').length&&$(e).find('img[id="preview_'+t+"_"+g+'"]').remove(),$(".staggs-view-gallery").find('img[id="button_preview_'+t+"_"+g+'"]').length&&$(".staggs-view-gallery").find('img[id="button_preview_'+t+"_"+g+'"]').remove()})}if($(".option-group-step-toggler[data-step-group-id="+o+"]").length&&$(".option-group-step-toggler[data-step-group-id="+o+"]").addClass("hidden"),$('.tab-list a[data-tabs*="'+o+'"]').length&&($('.tab-list a[data-tabs*="'+o+'"]').data("tabs")&&$('.tab-list a[data-tabs*="'+o+'"]').data("tabs").toString().includes(",")?$('.tab-list a[data-tabs*="'+o+'"]').each(function(t,e){var i=$(e).data("tabs").split(","),a=0;i.forEach(function(t,e){$("#option-group-"+t).hasClass("hidden")&&a++}),a===i.length&&a>0&&$(e).addClass("hidden")}):$('.tab-list a[data-tabs*="'+o+'"]').addClass("hidden")),!IMAGE_STACK){var g=$(a).find("input").attr("name");g||(g=$(a).find("select").attr("name")),g&&_deletePreviewGallery("",g)}$(a).parents(".option-group-step").length&&!$(a).parents(".option-group-step").find(".option-group").length&&$(a).parents(".option-group-step").addClass("hidden"),$(".staggs-product-view .preview-text-input").each(function(t,e){var i=$(e).attr("id");if($(e).parents(".preview-text-input-bundle").length){var n=$(e).parents(".preview-text-input-bundle").attr("id");n=n.replace("_wrapper",""),$(a).find("#option-group-"+n).length&&$(e).text("")}else $(a).find(".option-group input[data-field-key="+i+"]").length&&$(e).text("")}),$(".preview-image-input").each(function(t,e){var i=$(e).attr("id");$(a).find(".option-group input[data-field-key="+i+"]").length&&$(e).remove()}),$(a).html("")}}});var i=[];$(".option-group-options label[data-option-rules]").each(function(e,a){var n=$(a).data("option-rules"),o=$(a).find("input").length,s=_validateRuleset(n,t),r=$(a).attr("for");if(s){if(o)KEEP_CONDITIONAL_OPTIONS&&($('label[for="'+r+'"] input').prop("disabled",!1),$('label[for="'+r+'"]').removeClass("disabled"),$(this).parents(".option-group").find("label:not(.disabled) input:checked").length||$(this).parents(".option-group").find("label:not(.disabled) input").each(function(t,e){return $(e).prop("checked",!0),$(e).trigger("change"),!1}));else{if(!KEEP_CONDITIONAL_OPTIONS){var p=sessionStorage.getItem("sgg-option-"+r);$('label[for="'+r+'"]').html(p),$('label[for="'+r+'"]').removeClass("hidden")}i.push($(this).closest(".option-group"))}}else if(o){if(KEEP_CONDITIONAL_OPTIONS)$('label[for="'+r+'"] input').prop("checked",!1),$('label[for="'+r+'"] input').prop("disabled",!0),$('label[for="'+r+'"]').addClass("disabled"),$(this).parents(".option-group").find("label:not(.disabled) input:checked").length||$(this).parents(".option-group").find("label:not(.disabled) input").each(function(t,e){return $(e).prop("checked",!0),$(e).trigger("change"),!1});else{$(a).find("input").prop("checked",!1);var l=$(a).html();l&&sessionStorage.setItem("sgg-option-"+r,l),$(a).html(""),$(a).addClass("hidden"),i.push($(this).closest(".option-group"))}}}),$(".option-group-options select option[data-option-rules]").each(function(e,a){var n=$(a).data("option-rules"),o=_validateRuleset(n,t);o||$(a).hasClass("disabled")||$(a).hasClass("hidden")?o&&($(a).hasClass("disabled")||$(a).hasClass("hidden"))&&($(a).prop("disabled",!1),KEEP_CONDITIONAL_OPTIONS?$(a).removeClass("disabled"):$(a).removeClass("hidden"),i.push($(a).closest(".option-group"))):($(a).prop("selected",!1),$(a).prop("disabled",!0),KEEP_CONDITIONAL_OPTIONS?$(a).addClass("disabled"):$(a).addClass("hidden"),i.push($(a).closest(".option-group")))}),i.length&&i.forEach(function(t,e){setActiveStepOptions($(t))}),$(".tab-list a.active.hidden").length&&$(".tab-list a:not(.hidden)").length&&$(".tab-list a:not(.hidden)").get(0).click(),e.forEach(function(t,e){$(t).find(".option-group-options").each(function(t,e){setActiveStepOptions(e)})}),_setTotals()}function setConditionalStepHtml(t,e){$(t).html(e)}function activateConditionalStepFields(t){$(t).find(".option-group-options.select").length&&$(window).width()>991&&($(t).find(".ui-selectmenu-button").remove(),$(".staggs-product-options .option-group-options.select select").each(function(t,e){var i=$(e).selectmenu(_getSelectMenuOptions());i.data("ui-selectmenu")._renderItem=_selectMenuItemRenderer,i.data("ui-selectmenu")._renderButtonItem=_selectMenuButtonRenderer}),($(".staggs-configurator-main.border-rounded option-group-options.select").length||$(".option-group.border-rounded .option-group-options.select").length)&&$(".ui-selectmenu-menu").addClass("border-rounded"),($(".staggs-configurator-main.border-pill option-group-options.select").length||$(".option-group.border-pill .option-group-options.select").length)&&$(".ui-selectmenu-menu").addClass("border-pill"),$(".staggs-floating .option-group-step.collapsible .ui-selectmenu-button").length&&$(".staggs-floating .option-group-step.collapsible .ui-selectmenu-button").each(function(t,e){var i=$(e).attr("aria-owns");$(".ui-selectmenu-menu #"+i).addClass("floating-collapsible")})),$(t).find(".option-group-options input.datepicker-input").length&&$(t).find(".option-group-options input.datepicker-input").each(function(t,e){var i={};$(e).data("date-format")&&(i.dateFormat=$(".datepicker-input").data("date-format")),$(e).data("date-min")&&(i.minDate=$(".datepicker-input").data("date-min")),$(e).data("date-max")&&(i.maxDate=$(".datepicker-input").data("date-max")),$(e).data("inline")?($(e).next(".datepicker-input-inline").datepicker(i),$(e).next(".datepicker-input-inline").change(function(){$("input[type=text]").val($(this).val())})):$(e).datepicker(i).on("change",function(){$(this).trigger("input")}),($(".staggs-configurator-main.border-rounded").length||$(".option-group.border-rounded .option-group-options.text-input").length)&&$(".ui-datepicker.ui-widget").addClass("border-rounded"),($(".staggs-configurator-main.border-pill").length||$(".option-group.border-pill .option-group-options.text-input").length)&&$(".ui-datepicker.ui-widget").addClass("border-pill")}),$(t).find(".option-group-options input[data-type=range]").length&&$(t).find(".option-group-options input[data-type=range]").each(function(t,e){_initRangeSlider($(e))})}window.onbeforeunload=function(){window.scrollTo(0,0)},$(document).ready(function(){if(void 0===t)var t=!1;!SHOW_PRODUCT_PRICE&&$(".option-group.intro .price").length&&$(".option-group.intro .price").remove();var e=window.location.search;if(e&&(e.includes("configuration=")||e.includes("staggs_summary="))&&!e.includes("preview=true")){var i=e.split("&")[0];if(e.includes("configuration="))var a=i.replace("?configuration=","");else var a=i.replace("?staggs_summary=","");$.ajax({type:"post",url:AJAX_URL,async:!1,cache:!1,data:{action:"get_configuration_file",filename:a},success:function(t){shared_config=JSON.parse(t)}})}if(e&&e.includes("options=")&&!e.includes("preview=true")){var i=e.split("&")[0];if(i){var n=decodeURIComponent(i=i.replace("?options=",""));if(shared_config={values:JSON.parse(n=n.replaceAll("'",'"'))},e.includes("progress=")){var o=e.split("&")[1];if(o){var s=decodeURIComponent(o=o.replace("progress=",""));s=s.replaceAll("'",'"'),shared_config.progress=JSON.parse(s)}}}}if(e&&e.includes("staggs_summary=")&&!e.includes("preview=true")&&($(".staggs-configurator-main").addClass("summary-visible"),$(".staggs-summary-template").offset().top>300&&$("html,body").scrollTop($(".staggs-summary-template").offset().top)),DISABLE_MESSAGE_WRAPPER||$(".staggs-message-wrapper").length||$("body").append('<div class="staggs-message-wrapper"><div class="woocommerce-notices-wrapper"></div></div>'),!gallerySwiper&&$(".staggs-view-gallery.swiper").length){if($(".view-nav-buttons button[data-key=0]").addClass("selected"),(gallerySwiper=new Swiper(".staggs-view-gallery.swiper",{slidePerView:1,allowTouchMove:!0,breakpoints:{768:{allowTouchMove:!1}},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})).on("slideChange",function(){if($(".staggs-view-gallery").data("backgrounds")){var t=$(".staggs-view-gallery").data("backgrounds").split("|"),e=t[gallerySwiper.activeIndex]?t[gallerySwiper.activeIndex]:t[t.length-1];$(".product-view-inner").css("background-image","url("+e+")")}$(".view-nav-buttons button").removeClass("selected"),$(".view-nav-buttons button[data-key="+gallerySwiper.activeIndex+"]").addClass("selected")}),$(".staggs-view-gallery").data("backgrounds")){var r=$(".staggs-view-gallery").data("backgrounds").split("|"),p=r[gallerySwiper.activeIndex]?r[gallerySwiper.activeIndex]:r[r.length-1];$(".product-view-inner").css("background-image","url("+p+")")}}else $(".staggs-product-view .swiper-button-prev, .staggs-product-view .swiper-button-next").addClass("disabled");if($(".staggs-configurator-steps-nav").length){stepNavSwiper=new Swiper(".staggs-configurator-steps-nav",{slidesPerView:"auto",initialSlide:0,spaceBetween:10});var l=0;$(".staggs-configurator-steps-nav").find(".swiper-slide").each(function(t,e){l+=$(e).width()}),l<$(".staggs-configurator-steps-nav").width()&&$(".staggs-configurator-steps-nav").find(".swiper-wrapper").addClass("centered")}$(".staggs-configurator-main .swiper-options-nav").length&&(optionNavSwiper=new Swiper(".swiper-options-nav",{slidesPerView:"auto",initialSlide:0,spaceBetween:10})),!$(".option-group.total .totals-list").length&&SHOW_PRODUCT_PRICE&&($(".option-group.total .cart button").append('<span id="totalprice"></span>'),$(".option-group.total .cart button").addClass("inline_price")),!$(".staggs-configurator-bottom-bar .totals-list").length&&SHOW_PRODUCT_PRICE&&($(".staggs-configurator-bottom-bar .cart button").append('<span id="totalprice"></span>'),$(".staggs-configurator-bottom-bar .cart button").addClass("inline_price")),$(".staggs-message-wrapper .woocommerce-notices-wrapper").length||$(".staggs-message-wrapper").append('<div class="woocommerce-notices-wrapper"></div>'),!$("form.cart .quantity").hasClass("hidden")&&$("form.cart .quantity input[type=hidden]").length&&$("form.cart .quantity").addClass("hidden"),$(".option-group-spacer").length&&$(".option-group-spacer").height($(".option-group.total").height()+40),$(".staggs-view-gallery").data("backgrounds")&&$(".staggs-configurator-main").addClass("has-bg");var d=$("html").width();$(window).width()>767&&992>$(window).width()&&$(".staggs-product-view").height()>10&&(d=$(".staggs-product-view").height());var g=$(window).height()/2;d>g&&(d=g);var u=d;if($(".staggs-configurator-topbar").length&&(u+=$(".staggs-configurator-topbar").get(0).clientHeight),$(".staggs-configurator-steps-nav").length&&!$(".staggs-stepper").length&&(u+=$(".staggs-configurator-steps-nav").get(0).clientHeight),MOBILE_HEADER_HEIGHT&&(u+=parseInt(MOBILE_HEADER_HEIGHT)),!(992>$(window).width())||!$(".staggs-configurator").length||$(".staggs-configurator.has-theme-header").length||$(".staggs-configurator-popup.popup-horizontal").length||$(".staggs-configurator-contained").length||$(".staggs-configurator-inline").length||($("#staggs-preview .swiper-slide").length?($("#staggs-preview .swiper-slide").css("height",d),$("#staggs-preview .swiper-slide").css("maxHeight",d)):$(".staggs-view-gallery model-viewer").length&&$(".staggs-product-view").height(d),$(".staggs-configurator-steps-nav").length&&!$(".staggs-stepper").length&&$(".staggs-product-view").css("top",$(".staggs-configurator-steps-nav").get(0).clientHeight),$(".staggs-configurator-popup").length||$(".staggs-product-view.mobile-inline").length||$(".option-group-wrapper").css("marginTop",u),$(".staggs-configurator-bottom-bar-spacer").length&&$(".staggs-configurator-bottom-bar-spacer").height($(".staggs-configurator-bottom-bar").get(0).clientHeight)),($(".staggs-configurator-inline .gallery-sticky .staggs-product-view").length||$(".staggs-configurator.has-theme-header .gallery-sticky .staggs-product-view").length||$(".staggs-contained.gallery-sticky .staggs-product-view").length)&&992>$(window).width()){if($(".staggs-configurator-inline .gallery-sticky .staggs-product-view").length)var c=$(".staggs-configurator-inline"),f=$(".staggs-configurator-inline .gallery-sticky .staggs-product-view"),h=f.offset(),v=0;else{if($(".staggs-configurator.has-theme-header .gallery-sticky .staggs-product-view").length)var c=$(".staggs-configurator.has-theme-header"),f=$(".gallery-sticky .staggs-product-view");else var c=$(".staggs-contained"),f=$(".staggs-contained.gallery-sticky .staggs-product-view");var h=f.offset(),v=0}$(".staggs-configurator-steps-nav").length&&!$(".staggs-stepper").length&&(v=$(".staggs-configurator-steps-nav").get(0).clientHeight,$(".staggs-product-view").css("top",v)),$("#staggs-preview .swiper-slide").length&&(d=f.height(),u=f.height());var g=.4*$(window).height();d>g&&(d=g,u=g),MOBILE_HEADER_HEIGHT&&(u+=parseInt(MOBILE_HEADER_HEIGHT)),d>0&&(f.height(d),f.css("position","absolute")),u>d&&(v=u-d,f.css("top",v+"px")),$(".staggs-contained model-viewer").length&&$(".staggs-contained model-viewer").height($(".staggs-contained .staggs-product-view").height()),f.parents(".staggs-configurator-main").find(".staggs-product-options").prepend('<div class="gallery-spacer" style="height:'+u+'px"></div>'),MOBILE_HEADER_HEIGHT&&(f.css("position","fixed"),f.css("top",v+"px"),f.removeClass("stick")),$(window).scroll(function(){$(window).scrollTop()+30>=h.top&&$(window).scrollTop()<=c.height()-d+c.offset().top?(f.css("position","fixed"),f.css("top",MOBILE_HEADER_HEIGHT+"px"),f.addClass("stick")):(f.css("position","absolute"),f.css("top",v+"px"),f.removeClass("stick"))})}if(DISABLE_DEFAULTS&&_validateConditionalSteps(),1!==$(".staggs-configurator-topbar > *").length||$(".staggs-configurator-topbar #close-popup").length||$(".staggs-configurator-topbar").addClass("single-item"),$(".option-group-options.tabs").length&&$(".option-group-options.tabs").each(function(t,e){$(e).find(".tab-list a").each(function(t,e){var i=$(e).data("tabs");$(e).removeClass("active"),$(e).removeClass("hidden"),i.toString().includes(",")?(i=i.split(",")).forEach(function(t,e){$("div#option-group-"+t).addClass("tab-hidden")}):$("div#option-group-"+i).addClass("tab-hidden")}),$(e).find(".tab-list li:first-of-type a").trigger("click")}),$(".option-group-options.select").length&&$(window).width()>991&&($(".staggs-product-options .option-group-options.select select").each(function(t,e){var i=$(e).selectmenu(_getSelectMenuOptions());i.data("ui-selectmenu")._renderItem=_selectMenuItemRenderer,i.data("ui-selectmenu")._renderButtonItem=_selectMenuButtonRenderer}),($(".staggs-configurator-main.border-rounded option-group-options.select").length||$(".option-group.border-rounded .option-group-options.select").length)&&$(".ui-selectmenu-menu").addClass("border-rounded"),($(".staggs-configurator-main.border-pill option-group-options.select").length||$(".option-group.border-pill .option-group-options.select").length)&&$(".ui-selectmenu-menu").addClass("border-pill"),$(".staggs-floating .option-group-step.collapsible .ui-selectmenu-button").length&&$(".staggs-floating .option-group-step.collapsible .ui-selectmenu-button").each(function(t,e){var i=$(e).attr("aria-owns");$(".ui-selectmenu-menu #"+i).addClass("floating-collapsible")})),$(".option-group-options input.datepicker-input").length&&$(".option-group-options input.datepicker-input").each(function(t,e){var i={};$(e).data("date-format")&&(i.dateFormat=$(e).data("date-format")),$(e).data("date-min")&&(i.minDate=$(e).data("date-min")),$(e).data("date-max")&&(i.maxDate=$(e).data("date-max")),$(e).data("inline")?($(e).next(".datepicker-input-inline").datepicker(i),$(e).next(".datepicker-input-inline").change(function(){$(this).parent(".input-field").find("input[type=text]").val($(this).val()),$(this).parent(".input-field").find("input[type=text]").trigger("input")})):$(e).datepicker(i).on("change",function(){$(this).trigger("input")}),($(".staggs-configurator-main.border-rounded").length||$(".option-group.border-rounded .option-group-options.text-input").length)&&$(".ui-datepicker.ui-widget").addClass("border-rounded"),($(".staggs-configurator-main.border-pill").length||$(".option-group.border-pill .option-group-options.text-input").length)&&$(".ui-datepicker.ui-widget").addClass("border-pill")}),$(".option-group-options input[data-preview-index]").length&&$(".option-group-options input[data-preview-index]").each(function(t,e){"file"!==$(e).attr("type")&&_syncTextInputs($(e))}),$(".option-group-options textarea[data-preview-index]").length&&$(".option-group-options textarea[data-preview-index]").each(function(t,e){_syncTextInputs($(e))}),$(".option-group-options input[data-type=range]").length&&$(".option-group-options input[data-type=range]").each(function(t,e){_initRangeSlider($(e))}),$(".option-group .option-group-options").length&&$(".option-group .option-group-options").each(function(t,e){setActiveStepOptions(e)}),$(".staggs-repeater-main").length){var m=[];e&&(e.includes("configuration=")||e.includes("options=")||e.includes("staggs_summary="))&&!e.includes("preview=true")&&(m=shared_config.values),$(".staggs-repeater-main").each(function(t,e){_initializeRepeater($(e),m)})}_loadActiveStep(),_loadConfiguratorPopup(),_setTotals(),$(".staggs-product-options").removeClass("loading"),$(".preview-action.wishlist-toggle").length&&$("body").hasClass("logged-in")&&$.ajax({type:"get",url:AJAX_URL,data:{action:"staggs_fetch_customer_wishlist"},success:function(t){t.length>10&&(wishlist_items=JSON.parse(t))}})}),$(document).on("click",".option-group-step.collapsible .option-group-step-title",function(t){if(t.preventDefault(),$(this).parents(".staggs-configurator-bottom-bar")){var e,e=$(this).parent(".option-group-step").data("step-group-id");$(this).parent(".option-group-step").hasClass("collapsed")?($(".staggs-configurator-bottom-bar .option-group-step.collapsible").addClass("collapsed"),$(this).parent(".option-group-step").removeClass("collapsed"),$('.staggs-configurator-bottom-bar .option-group-step[data-step-group-id="'+e+'"]').removeClass("collapsed")):($(this).parent(".option-group-step").addClass("collapsed"),$('.staggs-configurator-bottom-bar .option-group-step[data-step-group-id="'+e+'"]').addClass("collapsed"))}else $(this).parent(".option-group-step").toggleClass("collapsed");$(this).parent(".option-group-step").hasClass("collapsed")||(e?$('.option-group-step[data-step-group-id="'+e+'"]').find(".option-group[data-slide-preview]:not(.hidden)").each(function(t,e){var i=$(this).data("slide-preview");gallerySwiper&&_setActiveImageSlide(i)}):$(this).parent(".option-group-step").find(".option-group[data-slide-preview]:not(.hidden)").each(function(t,e){var i=$(this).data("slide-preview");gallerySwiper&&_setActiveImageSlide(i)}))}),$(document).on("click",".option-group.collapsible .option-group-header",function(t){$(this).parents(".option-group").hasClass("collapsed")?$(this).parents(".option-group").removeClass("collapsed").addClass("open"):$(this).parents(".option-group").removeClass("open").addClass("collapsed")}),$(document).on("click",".option-group-options.tabs a",function(t){t.preventDefault(),$(this).parents(".tab-list").find("a").each(function(t,e){var i=$(e).data("tabs");$(e).removeClass("active"),$(e).removeClass("hidden"),i.toString().includes(",")?(i=i.split(",")).forEach(function(t,e){$("div#option-group-"+t).length&&$("div#option-group-"+t).addClass("tab-hidden")}):$("div#option-group-"+i).length?$("div#option-group-"+i).addClass("tab-hidden"):$(e).addClass("hidden")});var e=$(this).data("tabs");if(e.toString().includes(",")?(e=e.split(",")).forEach(function(t,e){$("div#option-group-"+t).removeClass("tab-hidden")}):$("div#option-group-"+e).removeClass("tab-hidden"),$(this).addClass("active"),$(this).data("slide-preview")){var i=$(this).data("slide-preview");_setActiveImageSlide(i)}}),$(".configurator-step-link").on("click",function(t){t.preventDefault();var e=$(this).data("step-number");e<=visitedStep&&(activeStep=e,_setActiveStep())}),$(".staggs-step-prev-button").on("click",function(t){t.preventDefault(),activeStep>minStep&&activeStep--,_setActiveStep()}),$(".staggs-step-next-button").on("click",function(t){t.preventDefault();var e=_validateStepFields();activeStep<maxStep&&e&&($(".configurator-step-link[data-step-number="+activeStep+"]").addClass("visited"),activeStep++,visitedStep++),_setActiveStep()}),$(document).on("click",".staggs-product-view button.fullscreen",function(t){t.preventDefault(),toggleFullScreen($(".staggs-product-view").get(0))}),$(document).on("click",".staggs-product-view button.capture-image",function(t){t.preventDefault(),_captureAndDownloadImage()}),$(document).mouseup(function(t){var e=$(".option-group-panel");e.is(t.target)||0!==e.has(t.target).length||($(".option-group-panel").removeClass("shown"),$("body").removeClass("panel-shown"))}),$(".staggs-configure-product-button").on("click",function(t){if(t.preventDefault(),$(".staggs-configurator-popup").addClass("active"),$("body").addClass("staggs-popup-active"),$(".staggs-message-wrapper").removeClass("inline"),992>$(window).width()&&!$(".staggs-configurator-popup.popup-horizontal").length&&!$(".staggs-configurator-popup.show-popup-mobile-inline").length){var e=$(".staggs-configurator-topbar").height()+$(".staggs-configurator-bottom-bar").height();e+=$(".staggs-product-view").height(),$(".staggs-product-options").css("height","calc( 100vh - "+e+"px )")}if($(".staggs-configurator-bottom-bar-spacer").length&&$(".staggs-configurator-bottom-bar-spacer").height($(".staggs-configurator-bottom-bar").height()),gallerySwiper&&$(".staggs-view-gallery").data("backgrounds")){var i=$(".staggs-view-gallery").data("backgrounds").split("|"),a=i[gallerySwiper.activeIndex]?i[gallerySwiper.activeIndex]:i[i.length-1];$(".product-view-inner").css("background-image","url("+a+")")}}),$("#close-popup").on("click",function(t){t.preventDefault(),$(".staggs-configurator-popup").removeClass("active"),$("body").removeClass("staggs-popup-active"),$(".staggs-message-wrapper").addClass("inline")}),$(".fieldset .fieldset-legend").on("click",function(t){t.preventDefault(),$(this).parents(".fieldset").toggleClass("closed")}),$(document).on("click",".view-nav-buttons button",function(t){t.preventDefault(),$(".view-nav-buttons button").removeClass("selected"),$(this).addClass("selected");var e=$(this).data("key");gallerySwiper.slideTo(e,!1,!1)}),$(document).on("click",".option-group.intro .back-button",function(t){if($(this).data("message"))return confirm($(this).data("message"))}),$(document).on("click","#totals-list-collapse",function(t){t.preventDefault(),$(this).parents(".totals-list").toggleClass("collapsed")}),$(document).on("click",".option-group-header a.show-panel",function(t){if(t.preventDefault(),$(this).parents(".option-group-content").next(".option-group-panel").length)$(this).parents(".option-group-content").next(".option-group-panel").addClass("shown"),$("body").addClass("panel-shown");else{var e=$(this).parents(".option-group").data("step");$(".staggs-configurator-main #description-panel-"+e).length?($(".staggs-configurator-main #description-panel-"+e).addClass("shown"),$("body").addClass("panel-shown")):$(this).next(".option-group-tooltip-description").toggleClass("shown")}}),$(document).on("click",".option-group-options a.show-panel-option",function(t){if(t.preventDefault(),$(this).closest(".option-group-content").find(".option-group-panel").length){var e=$(this).closest("label").find(".option-label").text();$(this).closest("label").find(".sgg-product-name").length&&(e=$(this).closest("label").find(".sgg-product-name").text());var i=$(this).closest("label").find(".option-description").html();$(this).closest(".option-group-content").find(".option-group-panel-label").text(e),$(this).closest(".option-group-content").find(".option-group-panel-content").html(i),$(this).closest(".option-group-content").find(".option-group-panel").addClass("shown"),$("body").addClass("panel-shown")}}),$(document).on("click",".option-group-panel a.close-panel",function(t){t.preventDefault(),$(this).parents(".option-group-panel").removeClass("shown"),$("body").removeClass("panel-shown")}),$(document).on("click",".option-group-options a.button-minus",function(t){t.preventDefault();var e=parseFloat($(this).siblings("input").val())??0,i=$(this).siblings("input").attr("min")??0,a=$(this).siblings("input").attr("step")??1;e-a>i?$(this).siblings("input").val(e-a):$(this).siblings("input").val(i),$(this).siblings("input").trigger("input")}),$(document).on("click",".option-group-options a.button-plus",function(t){t.preventDefault();var e=parseFloat($(this).siblings("input").val())??0,i=$(this).siblings("input").attr("min")??0,a=$(this).siblings("input").attr("max")??9999999999999,n=$(this).siblings("input").attr("step")??1;e+n<a?$(this).siblings("input").val(e+n):e?$(this).siblings("input").val(a):$(this).siblings("input").val(i),$(this).siblings("input").trigger("input")}),$(document).on("change","#configurator-options input[type=radio], #configurator-options input[type=checkbox], #configurator-options select",function(){_validateConditionalSteps()}),$(document).on("input","#configurator-options input[type=text], #configurator-options textarea, #configurator-options input[type=number]",function(){_validateConditionalSteps()}),$(document).on("click",".option-group:not(.hidden) label",function(){var t=$(this).parents(".option-group").data("slide-preview");t&&gallerySwiper&&_setActiveImageSlide(t)}),$(document).on("click",".option-group-options label",function(){$(this).find("input").data("page-url")&&!DISABLE_URL_CLICK&&$(this).find("input").data("page-url")!==window.location.href&&($(".staggs-configurator-main").addClass("loading-page"),window.location.href=$(this).find("input").data("page-url"))}),$(document).on("change",".option-group-options.options input",function(){var t=$(this).attr("name");"checkbox"===$(this).attr("type")&&(t=$(this).attr("id"));var e=$(this).parents(".option-group").data("step"),i=$(this).data("preview-urls"),a=$(this).parents(".option-group").data("preview-order"),n=parseFloat($(this).data("price"));if(TRACK_OPTIONS&&($(this).is("checked")?$(this).attr("checked","checked"):$(this).attr("checked",!1),TRACK_GLOBAL_OPTIONS&&sessionStorage.setItem(PRODUCT_ID+"_sgg_"+t+"_option",$(this).data("option-id"))),$(this).next(".option").length){var o="";$(this).is(":checked")&&(o=$(this).next(".option").find(".option-label").text()),$(this).parents(".option-group-content").find(".option-group-summary").find(".name").html(o)}else if($(this).next(".button").length){var o="";$(this).is(":checked")&&(o=$(this).next(".button").find(".button-name").text()),$(this).parents(".option-group-content").find(".option-group-summary").find(".name").html(o)}if(SHOW_PRODUCT_PRICE){if(isNaN(n)){var s="";$(this).is(":checked")&&(s=INC_PRICE_LABEL),$(this).parents(".option-group-content").find(".option-group-summary").find(".value").html(s),n=0}else{var r=$(this).data("price"),s="";if($(this).is(":checked")){if(isNaN(r)&&r.includes("|"))var p=r.split("|"),s=_formatPriceOutput(p[1])+" <del>"+_formatPriceOutput(p[0])+"</del>";else if(!isNaN(parseFloat(r))&&isFinite(r))var s=_formatPriceOutput(r)}$(this).parents(".option-group-content").find(".option-group-summary").find(".value").html(s)}$('#configurator-options [data-table-x="'+t+'"]').length&&$('#configurator-options [data-table-y="'+t+'"] input').trigger("input"),$('#configurator-options [data-table-y="'+t+'"]').length&&$('#configurator-options [data-table-y="'+t+'"] input').trigger("input")}else $(this).parents(".option-group-content").find(".option-group-summary").find(".value").html("");if(i&&$(this).is(":checked")?($(this).data("order")&&(a=$(this).data("order")),_buildPreviewGallery(i,t,a)):_deletePreviewGallery(i,t),_updatePreviewTextFont($(this)),$(this).data("input-key")){if($(this).data("color")){var l="color";$(this).data("preview-selector")&&(l=$(this).data("preview-selector")),_updatePreviewStyles($(this).data("input-key"),l+": "+$(this).data("color"))}else $(this).data("preview-selector")&&_updatePreviewStyles($(this).data("input-key"),$(this).data("preview-selector")+": "+$(this).val())}else $(this).closest(".option-group").data("model")&&$(this).data("color")&&_updateOptionMaterialCanvas($(this).closest(".option-group").data("model"),{fill:$(this).data("color")});$(this).is(":checked")?(pricetotal[t]=n,altpricetotal[t]=parseFloat($(this).data("alt-price"))):(delete pricetotal[t],delete altpricetotal[t]),_updateMeasurementPrices($(this),t),_recalculateMeasurementPricings($(this),t,e),_updateOptionPriceDisplay($(this),".option-price",n),_setTotals()}),$(document).on("change",".option-group-options.icons input",function(){var t=$(this).attr("name");"checkbox"===$(this).attr("type")&&(t=$(this).attr("id"));var e=$(this).parents(".option-group").data("step"),i=parseFloat($(this).data("price")),a=$(this).data("preview-urls"),n=$(this).parents(".option-group").data("preview-order");TRACK_OPTIONS&&($(this).is("checked")?$(this).attr("checked","checked"):$(this).attr("checked",!1),TRACK_GLOBAL_OPTIONS&&sessionStorage.setItem(PRODUCT_ID+"_sgg_"+t+"_option",$(this).data("option-id")));var o="";if($(this).is(":checked")&&(o=$(this).data("label")),$(this).parents(".option-group-content").find(".option-group-summary").find(".name").html(o),SHOW_PRODUCT_PRICE){if(isNaN(i)){var s="";$(this).is(":checked")&&(s=INC_PRICE_LABEL),$(this).parents(".option-group-content").find(".option-group-summary").find(".value").html(s),i=0}else{var r=$(this).data("label-value"),s="";if($(this).is(":checked")){if(isNaN(r)&&r.includes("|"))var p=r.split("|"),s=_formatPriceOutput(p[1])+" <del>"+_formatPriceOutput(p[0])+"</del>";else if(!isNaN(parseFloat(r))&&isFinite(r))var s=_formatPriceOutput(r)}$(this).parents(".option-group-content").find(".option-group-summary").find(".value").html(s)}}else $(this).parents(".option-group-content").find(".option-group-summary").find(".value").html("");if(a&&$(this).is(":checked")?($(this).data("order")&&(n=$(this).data("order")),_buildPreviewGallery(a,t,n)):_deletePreviewGallery(a,t),$(this).parents(".option-group").data("preview-ref")&&$(this).data("color")){var l="color";$(this).data("preview-selector")&&(l=$(this).data("preview-selector"));var d=l+": "+$(this).data("color");_updatePreviewStyles($(this).parents(".option-group").data("preview-ref"),d)}else if($(this).data("input-key")){if($(this).data("color")){var l="color";$(this).data("preview-selector")&&(l=$(this).data("preview-selector")),_updatePreviewStyles($(this).data("input-key"),l+": "+$(this).data("color"))}else $(this).data("preview-selector")&&_updatePreviewStyles($(this).data("input-key"),$(this).data("preview-selector")+": "+$(this).val())}else $(this).closest(".option-group").data("model")&&$(this).data("color")&&_updateOptionMaterialCanvas($(this).closest(".option-group").data("model"),{fill:$(this).data("color")});$(this).is(":checked")?(pricetotal[t]=i,altpricetotal[t]=parseFloat($(this).data("alt-price"))):(delete pricetotal[t],delete altpricetotal[t]),_updateMeasurementPrices($(this),t),_recalculateMeasurementPricings($(this),t,e),_updateOptionPriceDisplay($(this),".tooltip-price",i),_setTotals()}),$(document).on("change",".option-group-options.select select",function(){var t=$(this).attr("name"),e=parseFloat($(this).find(":selected").data("price")),i=$(this).find(":selected").data("preview-urls"),a=$(this).parents(".option-group").data("preview-order"),n=$(this).parents(".option-group").data("step");if(TRACK_OPTIONS&&($(this).find(":selected").attr("selected","selected"),TRACK_GLOBAL_OPTIONS&&sessionStorage.setItem(PRODUCT_ID+"_sgg_"+t+"_option",$(this).data("option-id"))),$(this).val()?($(this).removeClass("invalid"),$(this).parents(".option-group").find(".sgg-error").remove(),$(this).parents(".option-group-content").find(".option-group-summary").find(".name").html($(this).find(":selected").val()),SHOW_PRODUCT_PRICE?isNaN(e)?($(this).parents(".option-group-content").find(".option-group-summary").find(".value").html(INC_PRICE_LABEL),pricetotal[t]=0,altpricetotal[t]=0):($(this).parents(".option-group-content").find(".option-group-summary").find(".value").html(_formatPriceOutput(e)),pricetotal[t]=e,altpricetotal[t]=parseFloat($(this).find(":selected").data("alt-price"))):$(this).parents(".option-group-content").find(".option-group-summary").find(".value").html(""),i?($(this).data("order")&&(a=$(this).data("order")),_buildPreviewGallery(i,t,a)):_deletePreviewGallery(i,t)):($(this).parents(".option-group-content").find(".option-group-summary").find(".name").html(""),$(this).parents(".option-group-content").find(".option-group-summary").find(".value").html(""),delete pricetotal[t],delete altpricetotal[t],$('.staggs-view-gallery [id^="preview_"][id$="'+t+'"]').length&&$('.staggs-view-gallery [id^="preview_"][id$="'+t+'"]').remove()),$(this).find(":selected").data("input-key")){if($(this).find(":selected").data("color")){var o="color";$(this).data("preview-selector")&&(o=$(this).data("preview-selector")),_updatePreviewStyles($(this).find(":selected").data("input-key"),o+": "+$(this).find(":selected").data("color"))}else $(this).find(":selected").data("preview-selector")&&_updatePreviewStyles($(this).find(":selected").data("input-key"),$(this).find(":selected").data("preview-selector")+": "+$(this).find(":selected").val())}else $(this).closest(".option-group").data("model")&&$(this).find(":selected").data("color")&&_updateOptionMaterialCanvas($(this).closest(".option-group").data("model"),{fill:$(this).data("color")});_updatePreviewTextFont($(this).find(":selected")),_updateMeasurementPrices($(this),t),_recalculateMeasurementPricings($(this),t,n),_setTotals()}),$(document).on("change",".option-group-options.single input[type=checkbox]",function(){var t=$(this).attr("name"),e=parseFloat($(this).data("price")),i=$(this).data("preview-urls"),a=$(this).parents(".option-group").data("preview-order");TRACK_OPTIONS&&($(this).is(":checked")?$(this).attr("checked","checked"):$(this).attr("checked",!1)),isNaN(e)&&(e=0),i&&$(this).is(":checked")?($(this).data("order")&&(a=$(this).data("order")),_buildPreviewGallery(i,t,a)):_deletePreviewGallery(i,t),$(this).is(":checked")?(pricetotal[t]=e,altpricetotal[t]=parseFloat($(this).data("alt-price"))):(delete pricetotal[t],delete altpricetotal[t]),_setTotals()}),$(document).on("change",".option-group-options.tickboxes input[type=checkbox].tickboxes-all-option",function(){$(this).closest(".tickboxes").find("input:not(.tickboxes-all-option)").prop("checked",$(this).is(":checked")),$(this).closest(".tickboxes").find("input:not(.tickboxes-all-option)").trigger("change")}),$(document).on("change",".option-group-options.tickboxes input[type=checkbox]:not(.tickboxes-all-option)",function(){var t=$(this).attr("id"),e=parseFloat($(this).data("price")),i=$(this).data("preview-urls"),a=$(this).parents(".option-group").data("preview-order"),n=$(this).parents(".option-group").data("step");TRACK_OPTIONS&&($(this).is("checked")?$(this).attr("checked","checked"):$(this).attr("checked",!1)),isNaN(e)&&(e=0),i&&$(this).is(":checked")?($(this).data("order")&&(a=$(this).data("order")),_buildPreviewGallery(i,t,a)):_deletePreviewGallery(i,t),$(this).is(":checked")?(pricetotal[t]=e,altpricetotal[t]=parseFloat($(this).data("alt-price"))):(delete pricetotal[t],delete altpricetotal[t]),_updateMeasurementPrices($(this),t),_recalculateMeasurementPricings($(this),t,n),_setTotals()}),$(document).on("input",".option-group-options.text-input input, .option-group-options.text-input textarea",function(){var t,e,i,a,n=$(this).attr("name"),o=$(this).val().length,s=$(this).parents(".option-group").data("step");TRACK_OPTIONS&&$(this).attr("value",$(this).val()),"date"===$(this).data("type")?$(this).attr("required")?$(this).val()&&$(this).val().length>=10&&($(this).removeClass("invalid"),$(this).parents(".option-group").find(".sgg-error").remove()):($(this).removeClass("invalid"),$(this).parents(".option-group").find(".sgg-error").remove()):($(this).attr("minlength")&&(t=parseFloat($(this).attr("minlength"))),$(this).attr("maxlength")&&(e=parseFloat($(this).attr("maxlength"))),$(this).data("price")&&(i=parseFloat($(this).data("price"))),$(this).data("unit-price")&&(a=parseFloat($(this).data("unit-price"))),$(this).attr("required")?!t&&!e&&$(this).val()?($(this).removeClass("invalid"),$(this).parents(".option-group").find(".sgg-error").remove()):t&&o&&o<t?$(this).addClass("invalid"):e&&o&&o>e?$(this).addClass("invalid"):($(this).removeClass("invalid"),$(this).parents(".option-group").find(".sgg-error").remove()):$(this).val()?t&&o<t?$(this).addClass("invalid"):e&&o>e?$(this).addClass("invalid"):($(this).removeClass("invalid"),$(this).parents(".option-group").find(".sgg-error").remove()):($(this).removeClass("invalid"),$(this).parents(".option-group").find(".sgg-error").remove()));var r=$(this).parents(".option-group").data("model");if(""!=r||$(this).data("material-key")){var p=$(this).parents(".option-group").data("model-material");if(p||(p="base"),r||(r=$(this).data("material-key")),$("#"+n+"_canvas").length){var l=n+"_canvas",d={id:n,width:$(this).data("preview-width"),height:$(this).data("preview-height"),textAlign:"center"};if(sgg_canvasses.hasOwnProperty(l)){var g=_getCanvasObjectById(n,l);g[0].set("text",$(this).val())}else{sgg_canvasses[l]=new fabric.Canvas(l);var g=new fabric.Textbox($(this).val(),d);sgg_canvasses[l].add(g)}sgg_canvasses[l].renderAll();var u=sgg_canvasses[l].toDataURL();p||(p="base"),$.event.trigger({type:"modelMaterialChanged",model:r,channel:p,texture:u})}}i?$(this).val()?(pricetotal[n]=i,altpricetotal[n]=i):(delete pricetotal[n],delete altpricetotal[n]):a&&($(this).val()?(pricetotal[n]=a*o,altpricetotal[n]=a*o):(delete pricetotal[n],delete altpricetotal[n])),_updateMeasurementPrices($(this),n),_recalculateMeasurementPricings($(this),n,s),_setTotals()}),$(document).on("input",".option-group-options.measurements input[type=number]",function(){var t=parseFloat($(this).attr("min")),e=parseFloat($(this).attr("max")),i=parseFloat($(this).val());if(TRACK_OPTIONS&&$(this).attr("value",$(this).val()),$(this).attr("required")?!t&&!e&&$(this).val()?($(this).removeClass("invalid"),$(this).parents(".option-group").find(".sgg-error").remove()):t&&i<t?$(this).addClass("invalid"):e&&i>e?$(this).addClass("invalid"):($(this).removeClass("invalid"),$(this).parents(".option-group").find(".sgg-error").remove()):$(this).val()&&(t&&i<t?$(this).addClass("invalid"):e&&i>e?$(this).addClass("invalid"):($(this).removeClass("invalid"),$(this).parents(".option-group").find(".sgg-error").remove())),($(this).attr("required")||$(this).val())&&!$(this).hasClass("invalid")&&($(this).parents(".option-group").data("shared-min")||$(this).parents(".option-group").data("shared-max"))){var a=0;$(this).parents(".option-group").find("input[type=number]").each(function(t,e){a+=parseFloat($(e).val())}),_validateSharedFieldTotals($(this),a)}$(".staggs-summary-widget").length&&_updateSummary(),$(".sgg_field_summary").length&&_updateFormFieldSummary(),$("#staggs-send-email").length&&_updateEmailBodySummary()});var gallerySwiper,stepNavSwiper,optionNavSwiper,noticeTimeout,timer,delay=500;function _recalculateMeasurementPricings(t,e,i){var a=t.attr("name");$('#configurator-options .option-group-options[data-formula*="'+e+'"]').each(function(t,e){i===$(e).parents(".option-group").data("step")||$(e).find('input[name="'+a+'"]').length||$(e).find('select[name="'+a+'"]').length||($(e).find("input[type=radio]").length||$(e).find("input[type=checkbox]").length?$(e).find("input").trigger("change"):$(e).find("select").length?$(e).find("select").trigger("change"):$(e).find("input").trigger("input"))}),$('#configurator-options .option-group-options[data-table-x="'+e+'"]').each(function(t,e){i===$(e).parents(".option-group").data("step")||$(e).find('input[name="'+a+'"]').length||$(e).find('select[name="'+a+'"]').length||($(e).find("input[type=radio]").length||$(e).find("input[type=checkbox]").length?$(e).find("input").trigger("change"):$(e).find("select").length?$(e).find("select").trigger("change"):$(e).find("input").trigger("input"))}),$('#configurator-options .option-group-options[data-table-y="'+e+'"]').each(function(t,e){i===$(e).parents(".option-group").data("step")||$(e).find('input[name="'+a+'"]').length||$(e).find('select[name="'+a+'"]').length||($(e).find("input[type=radio]").length||$(e).find("input[type=checkbox]").length?$(e).find("input").trigger("change"):$(e).find("select").length?$(e).find("select").trigger("change"):$(e).find("input").trigger("input"))})}function _updateMeasurementPrices(t,e=""){var i=t.parents(".option-group-options").data("formula"),a=t.parents(".option-group-options").data("table");if(t.parents(".measurements").find("input[type=hidden]").length&&(e=t.parents(".option-group-options").find("input[type=hidden]").attr("id")),t.parents(".option-group-options").data("price-key")&&(e=t.parents(".option-group-options").data("price-key").toString()),a){var n,o,s=t.parents(".option-group-options").data("table-x"),r=t.parents(".option-group-options").data("table-y"),p=t.parents(".option-group-options").data("table-type-x"),l=t.parents(".option-group-options").data("table-type-y"),d=t.parents(".option-group-options").data("table-type"),g=t.parents(".option-group-options").data("table-round"),u=t.parents(".option-group-options").data("table-range"),c=t.parents(".option-group-options").data("table-min"),f=t.parents(".option-group-options").data("table-sale");t.parents(".option-group-options").find("input[type=number]").each(function(t,e){var i=$(e).data("field-key"),a=$(e).val();i===s?n=a:i===r&&(o=a)}),n||(n=$('[name="'+s+'"]:checked').length?$('[name="'+s+'"]:checked').val():$('[name="'+s+'"]').val()),o||(o=$('[name="'+r+'"]:checked').length?$('[name="'+r+'"]:checked').val():$('[name="'+r+'"]').val()),t.parents(".option-group-content").addClass("loading"),_getMatrixPriceTableValue(a,n,o,p,l,g,u,c,f).then(function(a){if(a.toString().includes("|"))var s=a.split("|"),r=parseFloat(s[1]),p=parseFloat(s[0]);else var r=parseFloat(a),p=parseFloat(a);if(t.parents(".option-group-content").removeClass("loading"),r){if("lookup"==d)var l=r,g=p;else if("doublemultiply"==d)var l=n*o*r,g=n*o*p;else var l=n*r+o*r,g=n*r+o*p}else var l=0,g=0;if(l<c&&(l=c),g<c&&(g=c),t.parents(".option-group-options").find("input[type=hidden]").val(l),"inside"===t.parents(".option-group-options").data("price-label-pos")){if(SHOW_PRODUCT_PRICE){var u=_formatPriceOutput(l);g&&(u+="<del>"+_formatPriceOutput(g)+"</del>"),t.parents(".option-group").find(".option-group-summary").find(".value").html(u)}else t.parents(".option-group").find(".option-group-summary").find(".value").html("")}else if(SHOW_PRODUCT_PRICE){var u=_formatPriceOutput(l);g!==l&&(u+="<del>"+_formatPriceOutput(g)+"</del>"),t.parents(".option-group").find(".option-group-price").html(u)}else t.parents(".option-group").find(".option-group-price").html("");pricetotal[e]=l,altpricetotal[e]=g,i&&_updateFormulaPrices(t,e),_setTotals()})}else if(i)_updateFormulaPrices(t,e);else{var h=t.data("unit-price"),v=t.data("table-price"),m=t.data("price"),w=t.val(),b=0;if(t.data("field-key"))var e=t.data("field-key");else var e=t.attr("name");h||m?(h?b=parseFloat(h*w):m&&(b=m),isNaN(b)&&(b=0),t.parents(".input-field-wrapper").find(".input-price").html(_formatPriceOutput(b)),t.val()?pricetotal[e]=b:delete pricetotal[e],_setTotals()):v&&_getPriceTableValue(v,e,w).then(i=>{var a=parseFloat(JSON.parse(i).price);isNaN(a)&&(a=0),t.parents(".input-field-wrapper").find(".input-price").html(_formatPriceOutput(a)),t.val()?pricetotal[e]=a:delete pricetotal[e],$('#configurator-options .option-group-options input[data-price-formula*="'+e+'"]').length?$('#configurator-options .option-group-options input[data-price-formula*="'+e+'"]').each(function(t,e){var i=$(e).attr("name");"checkbox"===$(e).attr("type")&&(i=$(e).attr("id")),_setSingleOptionFormulaPrice(e,i)}):$('#configurator-options .option-group-options option[data-price-formula*="'+e+'"]').length&&$('#configurator-options .option-group-options option[data-price-formula*="'+e+'"]').each(function(t,e){var i=$(e).parents("select").attr("name");_setSingleOptionFormulaPrice(e,i)}),_setTotals()})}$('#configurator-options .option-group-options input[data-price-formula*="'+e+'"]').length?$('#configurator-options .option-group-options input[data-price-formula*="'+e+'"]').each(function(t,e){var i=$(e).attr("name");"checkbox"===$(e).attr("type")&&(i=$(e).attr("id")),_setSingleOptionFormulaPrice(e,i)}):$('#configurator-options .option-group-options option[data-price-formula*="'+e+'"]').length&&$('#configurator-options .option-group-options option[data-price-formula*="'+e+'"]').each(function(t,e){var i=$(e).parents("select").attr("name");_setSingleOptionFormulaPrice(e,i)}),$('#configurator-options .option-group-options input[data-price-field="'+e+'"]').length?$('#configurator-options .option-group-options input[data-price-field="'+e+'"]').each(function(t,e){var i=$(e).attr("name");"checkbox"===$(e).attr("type")&&(i=$(e).attr("id")),_setSingleOptionPercentagePrice(e,i)}):$('#configurator-options .option-group-options option[data-price-field="'+e+'"]').length&&$('#configurator-options .option-group-options option[data-price-field="'+e+'"]').each(function(t,e){var i=$(e).parents("select").attr("name");_setSingleOptionPercentagePrice(e,i)});var y=t.parents(".option-group").attr("id");$("#configurator-options .option-group:not(#"+y+') input[data-price-field="sgg_total_price"]').length&&$("#configurator-options .option-group:not(#"+y+') input[data-price-field="sgg_total_price"]').each(function(t,e){var i=$(e).attr("name");"checkbox"===$(e).attr("type")&&(i=$(e).attr("id")),_setSingleOptionPercentagePrice(e,i)})}function _updateFormulaPrices($input,group){var formula=$input.parents(".option-group-options").data("formula"),pending_calls=[],empty_keys=[];if($input.parents(".option-group-options").find("input[type=number]").each(function(t,e){if($(e).data("field-key"))var i=$(e).data("field-key");else var i=group;var a=$(e).data("price"),n=$(e).data("unit-price"),o=$(e).data("table-price"),s=$(e).val();s?a?formula=formula.replaceAll(i,a):n?formula=(formula=(formula=formula.replaceAll(i+"_value",s)).replaceAll(i+"_price",n)).replaceAll(i,"("+s+" * "+n+")"):o?pending_calls.push(_getPriceTableValue(o,i,s)):formula=formula.replaceAll(i,"0"):empty_keys.push(i)}),pricetotal=Object.keys(pricetotal).sort(function(t,e){return t.length<e.length}).reduce((t,e)=>(t[e]=pricetotal[e],t),{}),pending_calls.length)$input.parents(".option-group-content").addClass("loading"),Promise.all(pending_calls).then(function(results){var price=0;results.forEach(function(t,e){var i=JSON.parse(t);formula=i.value?formula.replaceAll(i.index,"("+i.value+" * "+i.price+")"):formula.replaceAll(i.index,"0")});var regExp=/([a-zA-Z]+-*_*)+/g;if(regExp.test(formula)){for(var key in pricetotal)formula=formula.replaceAll(key,pricetotal[key]);var quantity=_getConfiguratorQuantity();quantity&&(formula=formula.replaceAll("quantity",quantity)),price=eval(formula=formula.replaceAll(regExp,"0"))}else price=eval(formula);$input.parents(".option-group-content").removeClass("loading"),$input.parents(".option-group-options").find("input[type=hidden]").val(price),"inside"===$input.parents(".option-group-options").data("price-label-pos")?SHOW_PRODUCT_PRICE?$input.parents(".option-group").find(".option-group-summary").find(".value").html(_formatPriceOutput(price)):$input.parents(".option-group").find(".option-group-summary").find(".value").html(""):SHOW_PRODUCT_PRICE?$input.parents(".option-group").find(".option-group-price").html(_formatPriceOutput(price)):$input.parents(".option-group").find(".option-group-price").html(""),pricetotal[group]=price,altpricetotal[group]=price,_setTotals()});else{var regExp=/([a-zA-Z]+-*_*)+/g,price=0;if(regExp.test(formula)){for(var key in pricetotal)formula=formula.replaceAll(key,pricetotal[key]);var quantity=_getConfiguratorQuantity();quantity&&(formula=formula.replaceAll("quantity",quantity)),price=eval(formula=formula.replaceAll(regExp,"0"))}else price=eval(formula);$input.parents(".option-group-options").find("input[type=hidden]").val(price),"inside"===$input.parents(".option-group-options").data("price-label-pos")?SHOW_PRODUCT_PRICE?$input.parents(".option-group").find(".option-group-summary").find(".value").html(_formatPriceOutput(price)):$input.parents(".option-group").find(".option-group-summary").find(".value").html(""):SHOW_PRODUCT_PRICE?$input.parents(".option-group").find(".option-group-price").html(_formatPriceOutput(price)):$input.parents(".option-group").find(".option-group-price").html(""),pricetotal[group]=price,altpricetotal[group]=price,_setTotals()}}function _setOptionFormulaPrices(t,e=""){if(!$(t).find("input[data-price-formula]").length){$(t).find("option[data-price-formula]").length&&$(t).find("option[data-price-formula]").each(function(t,i){_setSingleOptionFormulaPrice(i,e)});return}$(t).find("input[data-price-formula]").each(function(t,i){_setSingleOptionFormulaPrice(i,e)})}function _setSingleOptionFormulaPrice(input,group=""){var price_formula=$(input).data("price-formula");if(price_formula){for(var key in pricetotal)price_formula=(price_formula=price_formula.replaceAll(key+"_value",$('input[name="'+key+'"]').val())).replaceAll(key,pricetotal[key]);var quantity=_getConfiguratorQuantity();quantity&&(price_formula=price_formula.replaceAll("quantity",quantity));var regExp=/([a-zA-Z]+-*_*)+/g;price=regExp.test(price_formula)?eval(price_formula=price_formula.replaceAll(regExp,"0")):eval(price_formula),group&&group in pricetotal&&($(input).is(":checked")||$(input).is(":selected"))&&(pricetotal[group]=price),$(input).data("price",price),SHOW_PRODUCT_PRICE&&($(input).parents("label").find(".box-price").html(_formatPriceOutput(price)),$(input).parents("label").find(".option-price").html(_formatPriceOutput(price)),($(input).is(":checked")||$(input).is(":selected"))&&$(input).parents(".option-group").find(".option-group-summary").length&&$(input).parents(".option-group").find(".option-group-summary .value").html(_formatPriceOutput(price)))}}function _setOptionPercentagePrices(t,e=""){$(t).find("input[data-price-percent]").length&&$(t).find("input[data-price-percent]").each(function(t,i){_setSingleOptionPercentagePrice(i,e)})}function _setSingleOptionPercentagePrice(t,e=""){var i=$(t).data("price-percent"),a=$(t).data("price-field");if(i&&a){if("sgg_total_price"===a)price=getConfiguratorTotals(e)*(i/100);else{for(var n in pricetotal)a=a.replaceAll(n,pricetotal[n]);price=/([a-zA-Z]+-*_*)+/g.test(a)?0:a*(i/100)}$(t).data("price",price),SHOW_PRODUCT_PRICE&&($(t).parents("label").find(".box-price").html(_formatPriceOutput(price)),$(t).parents("label").find(".option-price").html(_formatPriceOutput(price))),$(t).is(":checked")&&e&&e in pricetotal&&(pricetotal[e]=price)}}function _setAttributeOptionSkus(t){var e=getConfiguratorOptionValues();$("#configurator-options input[data-sku-format]").each(function(t,i){var a=/{(.*?)}/,n=$(i).data("sku-format");e.forEach((t,e)=>{t.sku&&isNaN(t.value)?n=n.replace("{"+t.name+"}",t.sku):t.value&&(n=n.replace("{"+t.name+"}",t.value))}),a.test(n)||$(i).attr("data-sku",n)}),$("#configurator-options option[data-sku-format]").each(function(t,i){var a=/{(.*?)}/,n=$(i).data("sku-format");e.forEach((t,e)=>{t.sku&&isNaN(t.value)?n=n.replace("{"+t.name+"}",t.sku):t.value&&(n=n.replace("{"+t.name+"}",t.value))}),a.test(n)||$(i).attr("data-sku",n)})}function _updateOptionPriceDisplay(t,e,i){t.parents(".option-group-options").find(e+" span").length&&SHOW_PRODUCT_PRICE&&SHOW_PRICE_DIFFERENCE&&t.parents(".option-group-options").find("input").each(function(t,a){if($(a).is(":checked"))$(a).closest("label").find(e).html("");else{var n=($(a).data("price")??0)-i;$(a).closest("label").find(e).html(_formatPriceOutput(n,"",!1))}})}function _getConfiguratorQuantity(){var t=!1;if($(".option-group.total[data-quantity-id]").length){var e=$(".option-group.total").data("quantity-id");t=$('input[name="'+e+'"]').val()}else $(".option-group.total input.qty").length&&(t=$(".option-group.total input.qty").val());return t}function _getPriceTableValue(t,e,i){var a={action:"get_price_table_value",table_id:t,index:e,value:i};return $.ajax({type:"post",url:AJAX_URL,data:a})}function _getMatrixPriceTableValue(t,e,i,a,n,o,s,r,p){var l={action:"get_matrix_price_table_value",table_id:t,value_x:e,value_y:i,type_x:a,type_y:n,table_round:o,table_range:s,minprice:r,table_sale:p};return $.ajax({type:"post",url:AJAX_URL,data:l})}function processForm(t,e){var i=getConfiguratorOptionValues(),a=getConfiguratorTotals(),n={};for(var[o,s]of(t.addClass("loading"),i.forEach(function(t,e){!t.hidden&&(n[t.name]?n[t.name]=n[t.name]+", "+t.value:n[t.name]=t.value)}),Object.entries(n)))"object"==typeof s?s.forEach(function(e,i){t.parents("form").append('<input type="hidden" name="'+e.id+'" value="'+e.value+'"/>')}):t.parents("form").append('<input type="hidden" name="'+o+'" value="'+s+'"/>');if("download_pdf"==t.attr("id")&&t.parents("form").append('<input type="hidden" name="product_image" value="'+e+'"/>'),(t.parents(".staggs-configurator-main").find("#totalprice").length||t.parents(".option-group.total").find("#totalprice").length)&&t.parents("form").append('<input type="hidden" name="product_price" value="'+a+'"/>'),t.data("include_pdf")||t.data("include_image")||t.data("include_url")){var r={action:"staggs_get_configuration_form_urls",values:i,image:e};if(t.data("include_image")&&(r.image_id=t.data("include_image")),t.data("include_pdf")&&(r.pdf={product_id:t.data("include_pdf"),product_price:a}),t.data("include_url")){var p={values:i,progress:""};$(".option-group-step-buttons").length&&$(".option-group-step").length>1&&(p.progress={current:activeStep,visited:visitedStep,max:maxStep});var l=JSON.stringify(p);r.contents=l}$.ajax({type:"post",url:AJAX_URL,data:r,success:function(e){var i=JSON.parse(e);if(t.data("include_url")){var a=window.location.origin+window.location.pathname+"?configuration="+i.url;t.parents("form").append('<input type="hidden" name="product_url" value="'+a+'"/>')}t.data("include_image")&&t.parents("form").append('<input type="hidden" name="product_image" value="'+i.image_url+'"/>'),t.data("include_pdf")&&t.parents("form").append('<input type="hidden" name="product_pdf" value="'+i.pdf_url+'"/>'),t.parents("form").submit(),t.removeClass("loading"),$(".staggs-product-options").removeClass("loading")},error:function(e){t.parents("form").submit(),t.removeClass("loading"),$(".staggs-product-options").removeClass("loading")}})}else t.parents("form").submit(),$(".staggs-product-options").removeClass("loading")}function processPdfForm(t,e,i=""){var a="";if(SGG_LOADER_ICON&&t.find(".pdf-icon").length){var a=t.find(".pdf-icon").html();t.find(".pdf-icon").html(SGG_LOADER_ICON)}if(t.find("[type=submit]").addClass("loading"),t.parents(".staggs-summary-total-buttons").length)var n={product_id:shared_config.product,configuration:shared_config.values,product_price:shared_config.total,product_image:shared_config.image};else{var n={product_id:t.data("product"),configuration:[],product_image:e,product_price:""};n.configuration=getConfiguratorOptionValues(),n.product_price=getConfiguratorTotals()}""!==i&&(n.user_email=i);var o={values:n.configuration,progress:""};$(".option-group-step-buttons").length&&$(".option-group-step").length>1&&(n.progress={current:activeStep,visited:visitedStep,max:maxStep}),n.link=JSON.stringify(o),$.ajax({type:"post",url:AJAX_URL,data:{action:"staggs_download_configuration_pdf",pdf:n},success:function(e){let i=e,n=i.file.split(",")[1],o=atob(n),s=new Uint8Array(o.length);for(let r=0;r<o.length;r++)s[r]=o.charCodeAt(r);let p=new Blob([s],{type:"application/pdf"}),l=URL.createObjectURL(p),d=document.createElement("a");d.href=l,d.download=i.file_name,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(l),$(".staggs-product-options").removeClass("loading"),t.find("[type=submit]").removeClass("loading"),SGG_LOADER_ICON&&t.find(".pdf-icon").length&&t.find(".pdf-icon").html(a)}})}function processComplexEmailButton(t,e){t.addClass("loading");var i=getConfiguratorOptionValues(),a=getConfiguratorTotals();if(t.data("include_pdf")||t.data("include_image")||t.data("include_url")){var n={action:"staggs_get_configuration_form_urls",values:i,image:e};if(t.data("include_image")&&(n.image_id=t.data("include_image")),t.data("include_pdf")&&(n.pdf={product_id:t.data("include_pdf"),product_price:a}),t.data("include_url")){var o={values:i,progress:""};$(".option-group-step-buttons").length&&$(".option-group-step").length>1&&(o.progress={current:activeStep,visited:visitedStep,max:maxStep});var s=JSON.stringify(o);n.contents=s}$.ajax({type:"post",url:AJAX_URL,data:n,success:function(e){var i=JSON.parse(e),a="";t.data("include_url")&&(a+=window.location.origin+window.location.pathname+"?configuration="+i.url),t.data("include_image")&&(""!==a&&(a+="%0D%0A"),a+=i.image_url),t.data("include_pdf")&&(""!==a&&(a+="%0D%0A"),a+=i.pdf_url),_updateEmailBodySummary(a),t.removeClass("loading"),window.location.href=$("#staggs-send-email").attr("href")},error:function(e){t.removeClass("loading"),window.location.href=$("#staggs-send-email").attr("href")}})}else t.removeClass("loading"),window.location.href=$("#staggs-send-email").attr("href")}function processCartForm(t,e){$(document.body).trigger("adding_to_cart",[t,e]),$.ajax({type:"post",url:AJAX_URL,data:e,beforeSend:function(e){t.addClass("loading")},complete:function(e){t.removeClass("loading"),$(".staggs-product-options").removeClass("loading")},success:function(e){t.removeClass("loading"),"yes"===REDIRECT_TO_CART?window.location.href=CART_URL:e.fragments&&e.cart_hash&&($(document.body).trigger("added_to_cart",[e.fragments,e.cart_hash,t]),$(".staggs-message-wrapper").length?($(".staggs-message-wrapper .woocommerce-notices-wrapper").html(e.fragments.notices_html),$(".staggs-message-wrapper .woocommerce-error").length&&$(".staggs-message-wrapper .woocommerce-error li").append('<a href="#0" class="hide-notice"></a>'),$(".staggs-message-wrapper .woocommerce-message").length&&$(".staggs-message-wrapper .woocommerce-message").append('<a href="#0" class="hide-notice"></a>'),$(".staggs-message-wrapper").addClass("active"),noticeTimeout&&clearTimeout(noticeTimeout),noticeTimeout=setTimeout(function(){$(".staggs-message-wrapper").removeClass("active"),$(".staggs-message-wrapper").find(".woocommerce-notices-wrapper").html("")},12e3)):$("body").find(".woocommerce-notices-wrapper").html(e.fragments.notices_html))}})}function _validateConfiguratorForm(){var t=!0;return $("#configurator-options input[required], #configurator-options select[required], #configurator-options textarea[required]").each(function(){"radio"===$(this).attr("type")?$(this).parents(".option-group-options").find("input:checked").length?($(this).parents(".option-group").removeClass("invalid"),$(this).parents(".option-group").find(".sgg-error").remove()):($(this).parents(".option-group").addClass("invalid"),t=!1):"checkbox"===$(this).attr("type")?$(this).parents(".option-group-options").find("input:checked").length?($(this).parents(".option-group").removeClass("invalid"),$(this).parents(".option-group").find(".sgg-error").remove()):($(this).parents(".option-group").addClass("invalid"),t=!1):$(this).val()||($(this).addClass("invalid"),t=!1)}),t||(SINGLE_ERROR_MESSAGE?alert(REQUIRED_MESSAGE):($("#configurator-options .invalid").parents(".option-group").length&&!$("#configurator-options .invalid").parents(".option-group").find(".sgg-error").length&&$("#configurator-options .invalid").parents(".option-group").append('<small class="sgg-error">'+REQUIRED_FIELD_MESSAGE+"</small>"),$("#configurator-options .invalid .option-group-content .sgg-error").length||$("#configurator-options .invalid .option-group-content").append('<small class="sgg-error">'+REQUIRED_FIELD_MESSAGE+"</small>")),$(".sgg-error").length&&$("html, body").animate({scrollTop:$(".sgg-error").offset().top-300},500),t=!1),$("#configurator-options .invalid").length&&(SINGLE_ERROR_MESSAGE?alert(INVALID_MESSAGE):($("#configurator-options .invalid").parents(".option-group").length&&!$("#configurator-options .invalid").parents(".option-group").find(".sgg-error").length&&$("#configurator-options .invalid").parents(".option-group").append('<small class="sgg-error">'+INVALID_FIELD_MESSAGE+"</small>"),$("#configurator-options .invalid .option-group-content .sgg-error").length||$("#configurator-options .invalid .option-group-content").append('<small class="sgg-error">'+REQUIRED_FIELD_MESSAGE+"</small>")),$(".sgg-error").length&&$("html, body").animate({scrollTop:$(".sgg-error").offset().top-300},500),t=!1),t}function _validateSharedFieldTotals(t,e){var i=t.parents(".option-group").data("shared-min")??!1,a=t.parents(".option-group").data("shared-max")??!1;i&&e<i?t.parents(".option-group").find("input").addClass("invalid"):a&&e>a?t.parents(".option-group").find("input").addClass("invalid"):t.parents(".option-group").find("input").removeClass("invalid")}function getConfiguratorOptionValues(){var t=$("#configurator-options").serializeArray(),e=[];return t.forEach(function(t,i){var a="";if($('input[name="'+t.name+'"]').each(function(e,i){t.step_id=$(i).closest(".option-group").data("step"),t.step_sku=$(i).closest(".option-group").data("step-sku"),t.step_name=$(i).closest(".option-group").data("step-name"),t.hidden=$('input[name="'+t.name+'"]').closest(".option-group").hasClass("always-hidden");var n=$(i);"hidden"===$(i).attr("type")&&(n=$(i).closest("label").find('input[name="'+t.name+'-input"]')),$(i).val()===t.value&&$(i).data("option-id")&&(t.id=$(i).data("option-id"),t.step_id=$(i).data("step-id")),$(i).data("title")?t.label=$.trim($(i).data("title")):$(i).closest(".input-field-wrapper").length?t.label=$.trim($(i).closest(".input-field-wrapper").find(".input-title").text().replace("*","")):$(i).closest(".sgg-product-info").length?t.label=$.trim($(i).closest(".sgg-product-info").find(".sgg-product-name").text()):$('div[data-step="'+t.step_id+'"] .option-group-header').find(".title").text()&&(t.label=$.trim($('div[data-step="'+t.step_id+'"] .option-group-header').find(".title").text().replace("*",""))),$(i).data("product")&&(t.product=$(i).data("product")),($(i).val()===t.value||"file"===$(i).attr("type"))&&($(i).siblings(".option").find(".option-note").length?t.note=$.trim($(i).siblings(".option").find(".option-note").html()):$(i).siblings(".tooltip").find(".note").length?t.note=$.trim($(i).siblings(".tooltip").find(".note").html()):$(i).data("note")?t.note=$.trim($(i).data("note")):$(i).siblings(".box").find(".box-note").length?t.note=$.trim($(i).siblings(".box").find(".box-note").html()):$(i).closest(".input-field-wrapper").find(".option-note").length&&(t.note=$.trim($(i).closest(".input-field-wrapper").find(".option-note").html())),n.attr("data-sku")&&(t.sku=n.data("sku")),n.attr("data-weight")&&(t.weight=n.data("weight")),n.attr("data-price")&&(t.price=n.data("price")),n.attr("data-sale")&&(t.sale=n.data("sale")),n.attr("data-product-id")&&(t.product_id=n.data("product-id")),n.attr("data-product-qty")&&(t.product_qty=n.data("product-qty"))),$('input[name="'+t.name+'"]').closest("[data-repeater-list]").length&&(a=$('input[name="'+t.name+'"]').closest("[data-repeater-list]").data("repeater-list"))}),$('textarea[name="'+t.name+'"]').each(function(e,i){t.step_id=$(i).closest(".option-group").data("step"),t.step_sku=$(i).closest(".option-group").data("step-sku"),t.step_name=$(i).closest(".option-group").data("step-name"),t.hidden=$('textarea[name="'+t.name+'"]').closest(".option-group").hasClass("always-hidden"),$(i).val()===i.value&&$(i).data("option-id")&&(t.id=$(i).data("option-id"),t.step_id=$(i).data("step-id")),$(i).data("title")?t.label=$.trim($(i).data("title")):$(i).closest(".input-field-wrapper").length?t.label=$.trim($(i).closest(".input-field-wrapper").find(".input-title").text().replace("*","")):$('div[data-step="'+t.step_id+'"] .option-group-header').find(".title").text()&&(t.label=$.trim($('div[data-step="'+t.step_id+'"] .option-group-header').find(".title").text().replace("*",""))),$(i).closest(".input-field-wrapper").find(".option-note").length&&(t.note=$.trim($(i).closest(".input-field-wrapper").find(".option-note").html())),$(i).attr("data-sku")&&(t.sku=$(i).data("sku")),$(i).attr("data-price")&&(t.price=$(i).data("price")),$('textarea[name="'+t.name+'"]').closest("[data-repeater-list]").length&&(a=$('textarea[name="'+t.name+'"]').closest("[data-repeater-list]").data("repeater-list"))}),$('select[name="'+t.name+'"]').each(function(e,i){t.step_id=$(i).closest(".option-group").data("step"),t.step_sku=$(i).closest(".option-group").data("step-sku"),t.step_name=$(i).closest(".option-group").data("step-name"),$(i).find(":selected").val()===t.value&&$(i).find(":selected").data("option-id")&&(t.id=$(i).find(":selected").data("option-id"),t.step_id=$(i).find(":selected").data("step-id"),$(i).find(":selected").data("sku")&&(t.sku=$(i).find(":selected").data("sku")),$(i).find(":selected").data("weight")&&(t.weight=$(i).find(":selected").data("weight")),$(i).find(":selected").data("price")&&(t.price=$(i).find(":selected").data("price")),$(i).find(":selected").data("sale")&&(t.sale=$(i).find(":selected").data("sale")),$(i).find(":selected").data("product-id")&&(t.product_id=$(i).find(":selected").data("product-id")),$(i).find(":selected").data("product-qty")&&(t.product_qty=$(i).find(":selected").data("product-qty")),$('div[data-step="'+t.step_id+'"] .option-group-header').find(".title").text()&&(t.label=$('div[data-step="'+t.step_id+'"] .option-group-header').find(".title").text().replace("*",""))),t.hidden=$('select[name="'+t.name+'"]').parents(".option-group").hasClass("always-hidden"),$('select[name="'+t.name+'"]').parents("[data-repeater-list]").length&&(a=$('select[name="'+t.name+'"]').parents("[data-repeater-list]").data("repeater-list"))}),a){if(t.name.includes("[")){var n=t.name.split("["),i=parseInt(n[1].replace("]","")),o=n[2].replace("]",""),s=$.trim($('[data-repeater-list="'+a+'"]').closest(".staggs-repeater").find(".staggs-repeater-header .title").text()),r=a+"-"+(i+1);if(""!=t.value){t.id=t.name,t.name=o;var p=e.findIndex(t=>t.id===r);p>-1?e[p].value.push(t):e.push({id:r,name:r,label:s+" "+(i+1),value:[t]})}}}else""!=t.value&&e.push(t)}),e}function getConfiguratorTotals(exclude=""){var producttotal=0;USE_PRODUCT_PRICE&&(producttotal=PRODUCT_PRICE);var optiontotal=0,price_keys=Object.keys(pricetotal),prices=Object.values(pricetotal);for(var price_index in prices)exclude!=price_keys[price_index]&&(optiontotal+=parseFloat(prices[price_index]));var grandtotal=producttotal+optiontotal;if($(".option-group.total .button-wrapper").data("formula")){var formula=$(".option-group.total .button-wrapper").data("formula");for(var key in formula=(formula=(formula=formula.replaceAll("product_price",producttotal)).replaceAll("option_price",optiontotal)).replaceAll("total_price",grandtotal),pricetotal=Object.keys(pricetotal).sort(function(t,e){return t.length<e.length}).reduce((t,e)=>(t[e]=pricetotal[e],t),{}))formula=formula.replace(key,pricetotal[key]);var regExp=/([a-zA-Z]+-*_*)+/g;grandtotal=regExp.test(formula)?eval(formula=formula.replaceAll(regExp,"0")):eval(formula)}return grandtotal}function renderFinalProductImage(){return $(".staggs-view-gallery__images").addClass("capture-picture"),$(".staggs-view-gallery__image .preview-image-input-wrapper").each(function(t,e){$(e).find("img").height()>$(e).innerHeight()&&($(e).find("img").height($(e).innerHeight()),$(e).find(".preview-image-input").css("top","0")),$(e).find("img").width()>$(e).width()&&($(e).find("img").width($(e).width()),$(e).find(".preview-image-input").css("left","0"))}),_getFinalProductImage()}function setActiveStepOptions(t,e="",i=""){var a=window.location.search,n="",o="";if(""===e&&($(t).find("input").length?(e=$(t).find("input").data("step-id"),o=$(t).find("input").attr("name"),"checkbox"===$(this).attr("type")&&(o=$(this).attr("id"))):(e=$(t).find("select").data("step-id"),o=$(t).find("select").attr("name"))),a&&(a.includes("configuration=")||a.includes("options=")||a.includes("staggs_summary="))&&!a.includes("preview=true")){var s=shared_config.values;if(""===i)var r=s.filter(t=>t.step_id==e);else var r=s.filter(t=>t[i]==e);r.length>0&&(n=r[0])}if(TRACK_GLOBAL_OPTIONS&&sessionStorage.getItem(PRODUCT_ID+"_sgg_"+o+"_option")&&(n={name:o,id:sessionStorage.getItem(PRODUCT_ID+"_sgg_"+o+"_option")}),$(t).hasClass("tickboxes")||$(t).find('input[type="checkbox"]').length&&!$(t).hasClass("single")&&!$(t).hasClass("products"))$(t).find("label:not(.disabled)").each(function(t,e){var i=$(e).find("input").data("option-id");s&&(n=s.filter(t=>t.id==i)[0]),$(e).find("input").data("default")&&(n=1),n&&($(e).find("input").prop("checked",!0),$(e).find("input").trigger("change"))});else if($(t).hasClass("text-input")||$(t).hasClass("measurements"))$(t).find(".input-field-wrapper").each(function(t,e){if($(e).find("textarea").length)var i=$(e).find("textarea").attr("name");else var i=$(e).find("input").attr("name");s&&(n=s.filter(t=>t.name==i)[0]),n?($(e).find('input[name="'+n.name+'"]').val(urldecode(n.value)),$(e).find('input[name="'+n.name+'"]').trigger("input"),$(e).find("input[data-type=range]").length&&_setRangeSliderValue($(e).find("input[data-type=range]"),n.value),$(e).find("input[data-type=date]").length&&($(e).find("input[data-type=date]").next(".datepicker-input-inline").length?($(e).find("input[data-type=date]").next(".datepicker-input-inline").datepicker("setDate",n.value),$(e).find("input[data-type=date]").trigger("input")):($(e).find("input[data-type=date]").datepicker("setDate",n.value),$(e).find("input[data-type=date]").trigger("input")))):DISABLE_DEFAULTS||($(e).find("input[data-type=range]").length?_initRangeSlider($(e).find("input[data-type=range]")):$(e).find("input").trigger("input"))});else if($(t).hasClass("image-input"))$(t).find(".input-field-wrapper").each(function(t,e){var i=$(e).find("input[type=hidden]").attr("name");if(s&&(n=s.filter(t=>t.name==i)[0]),n){var a=n.url,o=a.split(".").at(-1),r=$(e).find("input"),p=r.data("step-id"),l=r.data("field-key"),d=r.data("material-key"),g=r.attr("id"),u=parseFloat(r.data("price"));if(l)var c=l;else if(d)var c=d;else var c=p;($(e).find(".show-if-input-value").removeClass("hidden"),_isImageExt(o))?($(e).find(".show-if-input-value").html('<div class="input-image-thumbnail"><img src="'+a+'"><span>'+n.value+'</span><a href="#0" class="remove-input-image" data-delete="'+c+'"></a></div>'),$("model-viewer").length)?document.querySelector("model-viewer").addEventListener("load",function(){_setImageUploadValue(r,a)}):_setImageUploadValue(r,a):$(e).find(".show-if-input-value").html('<div class="input-image-thumbnail"><span>'+n.value+'</span><a href="#0" class="remove-input-image" data-delete="'+c+'"></a></div>'),$(e).find(".hide-if-input-value").addClass("hidden"),$(e).find("input[type=hidden]").val(n.value+"|"+a),$(e).find("input[type=hidden]").trigger("input"),u&&(pricetotal[g]=u,altpricetotal[g]=u)}});else if($(t).hasClass("products"))$(t).find("label:not(.disabled)").each(function(e,i){var a=$(i).find("input").data("option-id"),o=$(i).find("input").attr("name");if(s){var r=s.filter(t=>t.id==a);n=r.length?r[0]:(r=s.filter(t=>t.id==o))[0]}if(n){if(n.id.toString().indexOf("][")){var p=$(t).find('input[name="'+n.id+'"]');"checkbox"==$(p).attr("type")?($(t).find('input[name="'+n.id+'"]').prop("checked",!0),$(t).find('input[name="'+n.id+'"]').trigger("change")):($(t).find('input[name="'+n.id+'"]').val(n.value),$(t).find('input[name="'+n.id+'"]').trigger("input"))}else{var p=$(t).find('input[name="'+n.name+'"][data-option-id="'+n.id+'"]');"checkbox"==$(p).attr("type")?($(t).find('input[name="'+n.name+'"][data-option-id="'+n.id+'"]').prop("checked",!0),$(t).find('input[name="'+n.name+'"][data-option-id="'+n.id+'"]').trigger("change")):($(t).find('input[name="'+n.name+'"][data-option-id="'+n.id+'"]').val(n.value),$(t).find('input[name="'+n.name+'"][data-option-id="'+n.id+'"]').trigger("input"))}}});else if($(t).find("label").length&&$(t).find("label").length>0){var o=$(t).data("group");if((!o||$('.option-group-options[data-group="'+o+'"]').find("input:checked").length)&&o)$(t).find("input:checked").length&&$(t).find("input:checked").trigger("change");else if(n)i&&i in n&&$(t).find('input[name="'+n[i]+'"][value="'+n.value+'"]:not(:disabled)').length?($(t).find('input[name="'+n[i]+'"][value="'+n.value+'"]').prop("checked",!0),$(t).find('input[name="'+n[i]+'"][value="'+n.value+'"]').trigger("change")):$(t).find('input[name="'+n.name+'"][data-option-id="'+n.id+'"]:not(:disabled)').length?($(t).find('input[name="'+n.name+'"][data-option-id="'+n.id+'"]').prop("checked",!0),$(t).find('input[name="'+n.name+'"][data-option-id="'+n.id+'"]').trigger("change")):$(t).find("label:not(.disabled)").each(function(t,e){if(!$(this).find(".out-of-stock").length)return $(e).find("input").prop("checked",!0),$(e).find("input").trigger("change"),!1});else if(!$(t).hasClass("single")&&!DISABLE_DEFAULTS){if($(t).find("label:not(.disabled):first-of-type .out-of-stock").length){var p=!1;$(t).find("label:not(.disabled)").each(function(t,e){if(!$(this).find(".out-of-stock").length&&!$(this).find("[disabled]").length)return $(e).find("input").prop("checked",!0),$(e).find("input").trigger("change"),p=!0,!1}),p||(isValidConfigurator=!1,$("button#order").remove())}else $(t).find("label:not(.disabled) input:checked").length?($(t).find("label:not(.disabled) input:checked").prop("checked",!0),$(t).find("label:not(.disabled) input:checked").trigger("change")):$(t).find("label:not(.disabled) input").each(function(t,e){return $(e).prop("checked",!0),$(e).trigger("change"),!1})}}else if($(t).find("select").length){if(n){var l=n.name;i&&i in n&&(l=n[i]),$(t).find('select[name="'+l+'"]').val(urldecode(n.value)),$(t).find('select[name="'+l+'"]').trigger("change"),$(t).find(".ui-selectmenu-button").length&&$(t).find('select[name="'+l+'"]').selectmenu("refresh",!0)}else{if($(t).find("select").find("option:selected"))var d=$(t).find("select").find("option:selected");else var d=$(t).find("select").find("option:not(:disabled):first-of-type");var g=$(d).attr("style");$(t).find("select").val($(d).attr("value")),$(t).find("select").trigger("change"),$(t).find(".ui-selectmenu-button").length&&($(t).find("select").selectmenu("refresh",!0),g&&($(t).find(".ui-selectmenu-button").find(".ui-selectmenu-text").attr("style",g),$(d).data("input-key")&&_updatePreviewTextFont($(d))))}}_setOptionFormulaPrices(t),_setOptionPercentagePrices(t)}function urldecode(t){return decodeURIComponent((t+"").replace(/\+/g,"%20"))}function _syncTextInputs(t,e=""){var i=t.data("field-key"),a=t.val(),n=t.data("preview-index"),o="",s=t.parents(".option-group").data("preview-order"),r=!1;if(""!==e&&(i+=e),!t.parents(".option-group").hasClass("always-hidden")){if(t.parents(".option-group").data("bundle-preview")&&(r=t.parents(".option-group").data("step")),t.data("unit")&&(a+=" "+t.data("unit")),i&&n){768>$(window).width()&&(t.data("preview-top-xs")||t.data("preview-left-xs")||t.data("preview-width-xs"))?(t.data("preview-top-xs")&&(o+="top:"+t.data("preview-top-xs")+";"),t.data("preview-left-xs")&&(o+="left:"+t.data("preview-left-xs")+";"),t.data("preview-width-xs")&&(o+="width:"+t.data("preview-width-xs")+";")):(t.data("preview-top")&&(o+="top:"+t.data("preview-top")+";"),t.data("preview-left")&&(o+="left:"+t.data("preview-left")+";"),t.data("preview-width")&&(o+="width:"+t.data("preview-width")+";")),t.data("preview-overflow")&&"hidden"==t.data("preview-overflow")&&(o+="overflow:"+t.data("preview-overflow")+";");var p=s;(s&&s.toString().includes(",")&&(s=s.split(",")),n.toString().includes(","))?n.split(",").forEach(function(t,e){Array.isArray(s)&&(p=s[e]),_setPreviewText(t,i,a,o,p,r)}):_setPreviewText(n,i,a,o,p,r),r&&t.parents(".option-group").data("bundle-height")&&$("#"+r+"_wrapper").css("maxHeight",t.parents(".option-group").data("bundle-height")),t.data("preview-overflow")&&"fittext"==t.data("preview-overflow")&&(r?_resizeTextToFit($("#"+r+"_wrapper"),parseInt($("#"+r+"_wrapper").css("font-size"))):_resizeTextToFit($("#"+i+"_wrapper"),parseInt($("#"+i+"_wrapper").css("font-size")))),$("#"+i).hasClass("init")&&$("#"+i).removeClass("init")}}}function _setPreviewText(t,e,i,a="",n=0,o=!1){t-=1;var s="z-index: "+n+";";a&&""!==a&&(s+=a),o?$("#preview_slide_"+t+" #"+o+"_wrapper").length?$("#preview_slide_"+t+" #"+o+"_wrapper #"+e).length?$("#preview_slide_"+t+" #"+o+"_wrapper #"+e+" .text-preview").length?$("#preview_slide_"+t+" #"+o+"_wrapper #"+e+" .text-preview").text(i):$("#preview_slide_"+t+" #"+o+"_wrapper #"+e).append('<span class="text-preview">'+i+"</span>"):$("#preview_slide_"+t+" #"+o+"_wrapper").append('<div class="preview-text-input init" id="'+e+'"><span class="text-preview">'+i+"</span></div></div>"):$("#preview_slide_"+t).append('<div class="preview-text-input-wrapper preview-text-input-bundle" id="'+o+'_wrapper" style="'+s+'"><div class="preview-text-input init" id="'+e+'"><span class="text-preview">'+i+"</span></div></div>"):$("#preview_slide_"+t).find("#"+e).length?$("#preview_slide_"+t+" #"+e).find(".text-preview").length?$("#preview_slide_"+t).find("#"+e+" .text-preview").text(i):$("#preview_slide_"+t).find("#"+e).append('<span class="text-preview">'+i+"</span>"):$("#preview_slide_"+t).append('<div class="preview-text-input-wrapper preview-text-input-single" id="'+e+'_wrapper" style="'+s+'"><div class="preview-text-input init" id="'+e+'"><span class="text-preview">'+i+"</span></div></div>"),n>zIndex&&(zIndex=n)}function _syncImageInputs(t){var e=$(t).data("field-key"),i=$(t).data("material-key"),a=$(t).data("step-id"),n=$(t).attr("id"),o=parseFloat($(t).data("price"));if(!$(t).parents(".option-group").hasClass("always-hidden")){if(e)var s=e;else if(i)var s=i;else var s=a;if(t.files&&t.files[0]){if($(t).data("size")){var r=parseFloat($(t).data("size")),p=1048576*r;if(t.files[0].size>p)return $(t).val(""),alert("File size should be less than "+r+" MB"),!1}var l=new FileReader;if(_isImageFile(t.files[0]))l.onload=function(e){_setImageUploadValue($(t),e.target.result),$(t).removeClass("invalid"),$(t).parents(".option-group").find(".sgg-error").remove(),$(t).parents(".image-input-field").find(".show-if-input-value").removeClass("hidden"),$(t).parents(".image-input-field").find(".show-if-input-value").html('<div class="input-image-thumbnail"><img src="'+e.target.result+'" alt="'+t.files[0].name+'"><span>'+t.files[0].name+'</span><a href="#0" class="remove-input-image" data-delete="'+s+'"></a></div>'),$(t).parents(".image-input-field").find(".hide-if-input-value").addClass("hidden"),$(t).parents(".image-input-field").find("input[type=hidden]").val(t.files[0].name+"|"+e.target.result);var i=_validateStepFields();activeStep<maxStep&&i?$(".staggs-step-next-button").removeClass("disabled"):$(".staggs-step-next-button").addClass("disabled"),$(".staggs-summary-widget").length&&_updateSummary()},l.readAsDataURL(t.files[0]);else{l.onload=function(e){$(t).removeClass("invalid"),$(t).parents(".option-group").find(".sgg-error").remove(),$(t).parents(".image-input-field").find(".show-if-input-value").removeClass("hidden"),$(t).parents(".image-input-field").find(".show-if-input-value").html('<div class="input-image-thumbnail"><span>'+t.files[0].name+'</span><a href="#0" class="remove-input-image" data-delete="'+s+'"></a></div>'),$(t).parents(".image-input-field").find(".hide-if-input-value").addClass("hidden"),$(t).parents(".image-input-field").find("input[type=hidden]").val(t.files[0].name+"|"+e.target.result);var i=_validateStepFields();activeStep<maxStep&&i?$(".staggs-step-next-button").removeClass("disabled"):$(".staggs-step-next-button").addClass("disabled"),$(".staggs-summary-widget").length&&_updateSummary()},l.readAsArrayBuffer(t.files[0]);var d=new FormData;d.append("file",t.files[0]),d.append("group",n),d.append("action","staggs_validate_file_upload");var g=$(t);$.ajax({type:"post",url:AJAX_URL,contentType:!1,processData:!1,data:d,success:function(t){var e=JSON.parse(t);g.parents(".image-input-field").find("input[type=hidden]").val(e.filename+"|"+e.filepath)},error:function(t){g.addClass("invalid"),g.parents(".option-group").find(".sgg-error").length||g.parents(".option-group").append('<div class="sgg-error">File could not be processed. Please try again.</div>'),g.parents(".image-input-field").find(".show-if-input-value").addClass("hidden"),g.parents(".image-input-field").find(".hide-if-input-value").removeClass("hidden"),g.parents(".image-input-field").find("input[type=hidden]").val("")}})}o&&(pricetotal[n]=o,altpricetotal[n]=o)}else o&&(delete pricetotal[n],delete altpricetotal[n]);_setTotals()}}function _setImageUploadValue(t,e){var i=t.data("field-key"),a=t.parents(".option-group").data("model"),n=t.data("preview-index"),o="",s=t.parents(".option-group").data("preview-order");if(""!=a||t.data("material-key")){var r=t.parents(".option-group").data("model-material");if(r||(r="base"),a||(a=t.data("material-key")),$("#"+i+"_canvas").length){var p=new fabric.Canvas(i+"_canvas");t.data("preview-width"),t.data("preview-height"),fabric.Image.fromURL(e,function(t){var e=p.width,i=p.height,n=t.width,o=t.height,s=Math.min(e/n,i/o);t.set({scaleX:s,scaleY:s,left:(e-n*s)/2,top:(i-o*s)/2,originX:"left",originY:"top"}),p.add(t),p.renderAll();var l=p.toDataURL();r||(r="base"),$.event.trigger({type:"modelMaterialChanged",model:a,channel:r,texture:l})})}}if(i){if(!n)return;t.data("preview-width")&&(o+="width:"+t.data("preview-width")+";"),t.data("preview-height")&&(o+="height:"+t.data("preview-height")+";"),768>$(window).width()&&t.data("preview-top-xs")?(t.data("preview-top-xs")&&(o+="top:"+t.data("preview-top-xs")+";"),t.data("preview-left-xs")&&(o+="left:"+t.data("preview-left-xs")+";")):(t.data("preview-top")&&(o+="top:"+t.data("preview-top")+";"),t.data("preview-left")&&(o+="left:"+t.data("preview-left")+";"));var l=s;(s&&s.toString().includes(",")&&(s=s.split(",")),n.toString().includes(","))?n.split(",").forEach(function(t,a){Array.isArray(s)&&(l=s[a]),_setPreviewImage(t,i,e,o,l)}):_setPreviewImage(n,i,e,o,l),$("span#"+i).hasClass("init")&&($("span#"+i).removeClass("init"),t.data("preview-fill")&&$("span#"+i).find("img").css("object-fit",t.data("preview-fill")))}_setTotals()}function _removeImageInput(t){var e=$(t).data("field-key"),i=$(t).parents(".option-group").data("model"),a=$(t).data("preview-index"),n=$(t).attr("id"),o=parseFloat($(t).data("price"));if(i){var s=$(t).parents(".option-group").data("model-material");s||(s="base"),$.event.trigger({type:"modelOptionsGroupRemoved",model:i,channel:s})}if(e){if(!a)return;a.toString().includes(",")?a.split(",").forEach(function(t,i){$("#preview_slide_"+(t-1)).find(".preview-image-input#"+e).remove()}):$("#preview_slide_"+(a-1)).find(".preview-image-input#"+e).remove()}$(t).val(""),$(t).next("input[type=hidden]").val(""),$(t).parents(".image-input-field").find(".hide-if-input-value").removeClass("hidden"),$(t).parents(".image-input-field").find(".show-if-input-value").html(""),o&&(delete pricetotal[n],delete altpricetotal[n]),_setTotals()}function _setPreviewImage(t,e,i,a="",n=0){t-=1;var o="z-index: "+n+";";a&&""!==a&&(o+=a),$("#preview_slide_"+t).find("#"+e).length?$("#preview_slide_"+t).find("#"+e+" img").attr("src",i):$("#preview_slide_"+t).append('<div class="preview-image-input-wrapper" id="'+e+'_wrapper" style="'+o+'"><span class="preview-image-input init" id="'+e+'"><img src="'+i+'"></span></div>'),a&&""!==a&&($("#preview_slide_"+t).find("#"+e+" img").css("height",$("#preview_slide_"+t+" #"+e+"_wrapper").innerHeight()),$("#preview_slide_"+t).find("#"+e+" img").css("width",$("#preview_slide_"+t+" #"+e+"_wrapper").width())),n>zIndex&&(zIndex=n)}function _updatePreviewTextStyle(t,e){var i=e.split(":");t.toString().includes(".")||t.toString().includes("#")?$(t).css(i[0],i[1].replace(";","")):$(".staggs-view-gallery").find("div#"+t+"_wrapper").length&&$(".staggs-view-gallery").find("div#"+t+"_wrapper").css(i[0],i[1].replace(";",""))}function _updateMultiplePreviewStyles(t,e,i=""){if(""!==t&&(e.parents(".option-group").data("preview-ref-props")||i&&""!==i)){var a=e.data("preview-selector"),n=e.parents(".option-group").data("preview-ref-props");-1!==a.indexOf(",")?(a=a.split(","),n=n.split(",")):(a=[a],n=[n]),i&&(n=-1!==i.indexOf(",")?i.split(","):[i]),n.forEach((e,i)=>{e=e.replace(" ",""),a[i]&&_updatePreviewStyles(t,e+": "+a[i])})}}function _updatePreviewStyles(t,e){t&&""!=t&&e&&""!=e&&(-1!==t.indexOf(",")?t.split(",").forEach((t,i)=>{_updatePreviewTextStyle(t=t.replace(" ",""),e)}):_updatePreviewTextStyle(t,e))}function _updatePreviewTextFont(t){var e=t.data("input-key");if(!e){t.closest(".option-group").data("model")&&_updateOptionMaterialCanvas(t.closest(".option-group").data("model"),{fontFamily:t.css("fontFamily").split(",")[0].replaceAll('"',""),fontWeight:t.css("fontWeight")});return}var i=t.data("font-family"),a=t.data("font-weight");if(!i||!a){_updateMultiplePreviewStyles(e,t);return}e.indexOf(",")?e.split(",").forEach((t,e)=>{if($(".preview-text-input#"+(t=t.replace(" ",""))).parents(".preview-text-input-bundle").length){var n=$(".preview-text-input#"+t).parents(".preview-text-input-bundle");if(n.length>1)n.each(function(t,e){var n=$(e).attr("id").replace("_wrapper","");_updatePreviewTextStyle(n,"font-family: "+i),_updatePreviewTextStyle(n,"font-weight: "+a),_resizeTextToFit($(e),parseInt($(e).css("font-size")))});else{var o=n.attr("id").replace("_wrapper","");_updatePreviewTextStyle(o,"font-family: "+i),_updatePreviewTextStyle(o,"font-weight: "+a),_resizeTextToFit(n,parseInt(n.css("font-size")))}}else _updatePreviewTextStyle(t,"font-family: "+i),_updatePreviewTextStyle(t,"font-weight: "+a)}):(_updatePreviewTextStyle(e,"font-family: "+i),_updatePreviewTextStyle(e,"font-weight: "+a)),t.data("preview-overflow")&&"fittext"==t.data("preview-overflow")&&(group?_resizeTextToFit($("#"+group+"_wrapper"),parseInt($("#"+group+"_wrapper").css("font-size")),action):_resizeTextToFit($("#"+label+"_wrapper"),parseInt($("#"+label+"_wrapper").css("font-size")),action))}function _initRangeSlider(t){var e=t.data("field-key"),i=parseInt(t.val()),a="";if(t.data("unit")&&(a=t.data("unit")),700>$(window).width()&&_makeRangeHandleDraggable(t.find("span.ui-slider-handle")),t.attr("min")&&t.attr("max")){var n={range:!1,value:i};t.attr("min")&&(n.min=parseInt(t.attr("min")),i||(n.value=n.min)),t.attr("max")&&(n.max=parseInt(t.attr("max"))),t.data("range-increments")&&(n.step=parseInt(t.data("range-increments"))),n.create=function(){if(t.data("range-bubble")){var e=jQuery(this).find(".ui-slider-handle"),i=jQuery('<div class="ui-slider-valuebox"></div>');jQuery(this).find(".ui-slider-valuebox").length||e.append(i)}},n.slide=function(i,n){if(t.val(n.value),t.parents("label").find("span.value").text(n.value+" "+a),$(".staggs-view-gallery #"+e).length&&$(".staggs-view-gallery #"+e).text(n.value+" "+a),t.data("range-bubble")&&(n.handle.childNodes[0].innerHTML=n.value),t.parents(".option-group").data("preview-ref")&&t.parents(".option-group").data("preview-ref-props")){var o=t.data("preview-selector").split(",");t.parents(".option-group").data("preview-ref-props").split(",").each(function(e,i){if(o[e])var s=i+":"+o[e];else var s=i+":"+n.value+a;_updatePreviewTextStyle(t.parents(".option-group").data("preview-ref"),s)})}},t.closest(".input-field").find(".range-slider").slider(n).bind("slidechange",function(e,i){_validateConditionalSteps(),_updateMeasurementPrices(t)});var i=t.closest(".input-field").find(".range-slider").slider("value");t.val(i),t.closest(".input-field").find(".range-slider").find(".ui-slider-valuebox").text(i),t.parents("label").find("span.value").text(i+" "+a)}else alert("Field min and max values are required for range input.")}function _setRangeSliderValue(t,e){var i="";t.data("unit")&&(i=t.data("unit")),t.closest(".input-field").find(".range-slider").slider("option","value",e),t.val(e),t.parents("label").find("span.value").text(e+" "+i)}function _makeRangeHandleDraggable(t){t.draggable({touchAction:"none",axis:"x",containment:"parent",drag:function(e,i){var a=t.closest(".range-slider"),n=0,o=a.width()-t.width(),s=Math.round((i.position.left-n)/(o-n)*(a.slider("option","max")-a.slider("option","min"))+a.slider("option","min"));a.slider("value",s);var r=a.find(".left-default-value"),p=r.width(),l=i.position.left-p/2+t.width()/2;r.css("left",l)}})}function _validateRuleset(conditionalRules,keyValuePairs){var validRules={},jsonRules=conditionalRules.replaceAll("'",'"');jsonRules=JSON.parse(jsonRules);for(var r=0;r<jsonRules.length;r++){var ruleSet=jsonRules[r],compareResult=!1,valueIndex=0,ruleKey=ruleSet.key;if(ruleKey&&-1!==ruleKey.toString().indexOf("-")&&(ruleKey=ruleSet.key.split("-")[0],valueIndex=ruleSet.key.split("-")[1]),ruleKey in keyValuePairs)switch(ruleSet.compare){case"!empty":compareResult=!0;break;case"<=":compareResult=parseFloat(keyValuePairs[ruleKey][valueIndex])<=parseFloat(ruleSet.value);break;case">=":compareResult=parseFloat(keyValuePairs[ruleKey][valueIndex])>=parseFloat(ruleSet.value);break;case"<":compareResult=parseFloat(keyValuePairs[ruleKey][valueIndex])<parseFloat(ruleSet.value);break;case">":compareResult=parseFloat(keyValuePairs[ruleKey][valueIndex])>parseFloat(ruleSet.value);break;case"!=":compareResult=!keyValuePairs[ruleKey].includes(ruleSet.value);break;default:compareResult=keyValuePairs[ruleKey].includes(ruleSet.value)}else"empty"===ruleSet.compare&&(compareResult=!0);validRules[r]={result:compareResult,compare:ruleSet.relation,newset:"yes"==ruleSet.newset}}var valid=!1,finalRule="",validRuleKeys=Object.keys(validRules);return validRuleKeys.forEach(function(t,e){if(finalRule+=validRules[t].result,e>=0&&e+1<validRuleKeys.length){var i=validRules[t].compare,a="";a="and"==i?"&&":"||",validRules[t].newset?finalRule+=")"+a+"(":finalRule+=a}}),""!==finalRule&&(valid=eval(finalRule="("+finalRule+")")),valid}function _buildPreviewGallery(t,e,i=0){t=t.split(",");var a=i;if(i&&i.toString().includes(",")&&(i=i.split(",")),t.length){for(var n in t){var o=t[n].split("|")[0],s=t[n].split("|")[1];Array.isArray(i)&&(a=i[n]),IMAGE_STACK?e=e.replaceAll("[","_").replaceAll("]",""):(lastImages[e]=s,e=0),$(".staggs-view-gallery #preview_"+o+"_"+e).length?($(".staggs-view-gallery #preview_"+o+"_"+e).attr("src",s),$(".view-nav-buttons #button_preview_"+o+"_"+e).attr("src",s)):($("#preview_slide_"+o).append('<img id="preview_'+o+"_"+e+'" src="'+s+'" alt="" style="z-index: '+a+'">'),$("#preview_nav_"+o).append('<img id="button_preview_'+o+"_"+e+'" src="'+s+'" alt="" style="z-index: '+a+'">')),!USE_PRODUCT_THUMBNAIL&&($("#preview_"+o+"_preview").length&&$("#preview_"+o+"_preview").remove(),$("#button_preview_"+o+"_preview").length&&$("#button_preview_"+o+"_preview").remove())}i>zIndex&&(zIndex=i)}}function _deletePreviewGallery(t,e){if(IMAGE_STACK){if(t){if((t=t.split(",")).length)for(var i in t){var a=t[i].split("|")[0];$(".staggs-view-gallery #preview_"+a+"_"+e).length&&($(".staggs-view-gallery #preview_"+a+"_"+e).remove(),$(".staggs-view-gallery #button_preview_"+a+"_"+e).remove())}}else $('.staggs-view-gallery [id^="preview_"][id$="'+e+'"]').length&&($('.staggs-view-gallery [id^="preview_"][id$="'+e+'"]').remove(),$('.staggs-view-gallery [id^="button_preview_"][id$="'+e+'"]').remove())}else{delete lastImages[e];var n=lastImages[Object.keys(lastImages)[Object.keys(lastImages).length-1]],a=0;$(".staggs-view-gallery #preview_"+a+"_0").attr("src",n),$(".staggs-view-gallery #button_preview_"+a+"_0").attr("src",n)}}function _getFinalProductImage(){var t=PRODUCT_THUMBNAIL_URL,e="",i=!1;return $("#preview_slide_0").length?(i=!0,$("#preview_slide_0 noscript").length&&($("#preview_slide_0 noscript").html(""),$("#preview_slide_0 noscript").remove()),$("#staggs-preview[data-include-bg]").length&&($("#preview_slide_0").css("backgroundImage",$(".product-view-inner").css("backgroundImage")),$(".product-view-inner").css("backgroundSize")&&($("#preview_slide_0").css("backgroundSize",$(".product-view-inner").css("backgroundSize")),$("#preview_slide_0").css("backgroundPosition",$(".product-view-inner").css("backgroundPosition")))),e=modernScreenshot.domToPng(document.getElementById("preview_slide_0"))):$(".staggs-view-gallery model-viewer").length?($(".staggs-view-gallery model-viewer").attr("camera-orbit",$(".staggs-view-gallery").data("base-orbit")??"auto"),$(".staggs-view-gallery model-viewer").attr("camera-target",$(".staggs-view-gallery").data("base-target")??"auto"),$(".staggs-view-gallery model-viewer").attr("field-of-view",$(".staggs-view-gallery").data("base-view")),e=new Promise(function(t,i){setTimeout(function(){t(e=document.getElementById("product-model-view").toDataURL())},500)}),i=!0):e=t,{image:e,isPromise:i}}function _clearProductBackgroundImage(){$("#staggs-preview[data-include-bg]").length&&$("#preview_slide_0").css("backgroundImage","")}function _setTotalsButton(t){$(".option-group.total").data("show-step")&&"final"===$(".option-group.total").data("show-step")&&(activeStep===maxStep?$(".option-group.total").data("step-valid")&&"required"===$(".option-group.total").data("step-valid")?t&&($(".option-group.total").removeClass("hidden"),$(".option-group.total form .button").prop("disabled",!1)):($(".option-group.total").removeClass("hidden"),$(".option-group.total form .button").prop("disabled",!1)):($(".option-group.total").addClass("hidden"),$(".option-group.total form .button").prop("disabled",!0))),$(".bottom-bar-totals").data("show-step")&&"final"===$(".bottom-bar-totals").data("show-step")&&(activeStep===maxStep?$(".bottom-bar-totals").data("step-valid")&&"required"===$(".bottom-bar-totals").data("step-valid")?t&&($(".bottom-bar-totals").removeClass("hidden"),$(".bottom-bar-totals form .button").prop("disabled",!1),_stepActivateCartButton()):($(".bottom-bar-totals").removeClass("hidden"),$(".bottom-bar-totals form .button").prop("disabled",!1),_stepActivateCartButton()):($(".bottom-bar-totals").addClass("hidden"),$(".bottom-bar-totals form .button").prop("disabled",!0),_stepResetCartButton())),activeStep===maxStep?($(".option-group.total form").addClass("option-group-step-last"),$(".bottom-bar-totals form").addClass("option-group-step-last")):($(".option-group.total form").removeClass("option-group-step-last"),$(".bottom-bar-totals form").removeClass("option-group-step-last")),$.event.trigger({type:"setActiveConfiguratorButtons",active:activeStep,max:maxStep})}function _stepActivateCartButton(){if($(".bottom-bar-totals").data("button-position")&&"step-controls"===$(".bottom-bar-totals").data("button-position")&&!$(".bottom-bar-totals").attr("data-replaced")){$(".staggs-configurator-bottom-bar").addClass("buttons-reversed");var t=$(".bottom-bar-totals .button-wrapper .cart").get(0).outerHTML;$(".bottom-bar-totals .button-wrapper .cart").html(""),$(".option-group-step-buttons").append(t),$(".bottom-bar-totals").attr("data-replaced","replaced")}}function _stepResetCartButton(){if($(".bottom-bar-totals").data("button-position")&&"step-controls"===$(".bottom-bar-totals").data("button-position")){var t=$(".option-group-step-buttons .cart").html();$(".option-group-step-buttons .cart").remove(),$(".bottom-bar-totals .cart").append(t),$(".bottom-bar-totals").removeAttr("data-replaced")}}async function _setTotals(){var total=0,alttotal=0,groupnames=[];for(var priceitem in $("#configurator-options input, #configurator-options textarea, #configurator-options select").each(function(t,e){if($(e).data("field-key"))var i=$(e).data("field-key");else var i=$(e).attr("name");("checkbox"===$(e).attr("type")||"hidden"===$(e).attr("type")||$(e).parents(".sgg-product").length)&&(i=$(e).attr("id")),$(e).parents(".measurements").length&&$(e).parents(".measurements").data("price-key")&&(i=$(e).parents(".measurements").data("price-key")),groupnames.includes(i)||groupnames.push(i)}),pricetotal)groupnames.includes(priceitem)||(delete pricetotal[priceitem],delete altpricetotal[priceitem]);var prices=Object.values(pricetotal);for(var price_key in prices)total+=parseFloat(prices[price_key]);var altprices=Object.values(altpricetotal);for(var alt_price_key in altprices)alttotal+=parseFloat(altprices[alt_price_key]);if($(".total #productprice").length){var productPrice=_formatPriceOutput(PRODUCT_PRICE,"",!0);PRODUCT_ALT_PRICE>PRODUCT_PRICE&&(productPrice+="<del>"+_formatPriceOutput(PRODUCT_ALT_PRICE,"",!0)+"</del>"),$(".option-group.total #productprice").html(productPrice),$(".staggs-product-options-basic #productprice").html(productPrice)}if($(".total #optionsprice").length){var optionPrice=_formatPriceOutput(total,"",!0);total<alttotal&&(optionPrice+="<del>"+_formatPriceOutput(alttotal,"",!0)+"</del>"),$(".option-group.total #optionsprice").html(optionPrice),$(".staggs-product-options-basic #optionsprice").html(optionPrice)}var quantity=_getConfiguratorQuantity();quantity||(quantity=1);var grandtotal=total,altgrandtotal=alttotal;if(USE_PRODUCT_PRICE){if($(".option-group.total[data-table-id]").length){var tableResult=await _getPriceTableValue($(".option-group.total").data("table-id"),"quantity",quantity);if(tableResult){var result=JSON.parse(tableResult);grandtotal=total+parseFloat(result.price),altgrandtotal=alttotal+parseFloat(result.price)}}else grandtotal=total+PRODUCT_PRICE,altgrandtotal=alttotal+PRODUCT_ALT_PRICE}if($(".option-group.total .button-wrapper").data("formula")){var formula=$(".option-group.total .button-wrapper").data("formula");for(var key in formula=(formula=(formula=formula.replaceAll("product_price",PRODUCT_PRICE)).replaceAll("option_price",total)).replaceAll("total_price",grandtotal),pricetotal=Object.keys(pricetotal).sort(function(t,e){return t.length<e.length}).reduce((t,e)=>(t[e]=pricetotal[e],t),{}))formula=formula.replaceAll(key,pricetotal[key]);formula=formula.replaceAll("quantity",quantity);var regExp=/([a-zA-Z]+-*_*)+/g;regExp.test(formula)?(grandtotal=eval(formula=formula.replaceAll(regExp,"0")),altgrandtotal=eval(formula)):(grandtotal=eval(formula),altgrandtotal=eval(formula))}if($(".option-group.total[data-qty-totals]").length&&quantity&&(grandtotal*=quantity,altgrandtotal*=quantity),$(".option-group.total #totaltaxprice").length){if("incl"==PRODUCT_TAX_DISPLAY&&PRODUCT_TAX){var taxtotal=grandtotal/(1+PRODUCT_TAX/100);$(".option-group.total #totaltaxprice").html(_formatPriceOutput(taxtotal,"",!0)+" "+ALT_TAX_PRICE_SUFFIX)}else if("excl"==PRODUCT_TAX_DISPLAY&&PRODUCT_TAX){var taxtotal=grandtotal+grandtotal*(PRODUCT_TAX/100);$(".option-group.total #totaltaxprice").html(_formatPriceOutput(taxtotal,"",!0)+" "+ALT_TAX_PRICE_SUFFIX)}}var grandtotaltaxhtml=_formatPriceOutput(grandtotal,"",!0),grandtotalhtml=_formatPriceOutput(grandtotal,"",!0);if(altgrandtotal>grandtotal&&(grandtotaltaxhtml+="<del>"+_formatPriceOutput(altgrandtotal,"",!0)+"</del>",grandtotalhtml+="<del>"+_formatPriceOutput(altgrandtotal,"",!0)+"</del>"),grandtotaltaxhtml+=" "+TAX_PRICE_SUFFIX,$(".option-group.total #totalprice").html(grandtotaltaxhtml),$(".staggs-product-options-basic #totalprice").html(grandtotaltaxhtml),$(".staggs-configurator-bottom-bar #totalprice").html(grandtotaltaxhtml),DISABLE_PRODUCT_PRICE_UPDATE||($(".option-group.intro .price").length&&$(".option-group.intro .price").html(grandtotaltaxhtml),$(".entry-summary .price").length&&!$(".staggs-configurator-popup").length&&$(".entry-summary .price").html(grandtotaltaxhtml)),$("#product_weight").length){var weight=PRODUCT_WEIGHT;getConfiguratorOptionValues().forEach(function(t,e){t.weight&&(weight+=t.weight)}),$("#product_weight").text(weight+" "+PRODUCT_WEIGHT_UNIT)}if($(".option-group-step-buttons").length){var validStep=_validateStepFields();activeStep<maxStep&&validStep?$(".staggs-step-next-button").removeClass("disabled"):$(".staggs-step-next-button").addClass("disabled"),_setTotalsButton(validStep)}($("#configurator-options input[data-sku-format]").length||$("#configurator-options option[data-sku-format]").length)&&_setAttributeOptionSkus(),$(".staggs-summary-widget").length&&_updateSummary(),$(".sgg_field_summary").length&&_updateFormFieldSummary(),$("#staggs-send-email").length&&_updateEmailBodySummary(),window.pysWooProductData&&window.pysWooProductData[PRODUCT_ID]&&(window.pysWooProductData[PRODUCT_ID].google_ads&&(window.pysWooProductData[PRODUCT_ID].google_ads.params.value=grandtotal),window.pysWooProductData[PRODUCT_ID].facebook&&(window.pysWooProductData[PRODUCT_ID].facebook.params.value=grandtotal),window.pysWooProductData[PRODUCT_ID].ga&&(window.pysWooProductData[PRODUCT_ID].ga.params.value=grandtotal))}function _updateFormFieldSummary(){var t="",e=getConfiguratorOptionValues();e.length?e.forEach(function(e,i){if(Array.isArray(e.value)){var a=""+e.label+":\n";e.value.forEach(function(t,e){if($('input[name="'+t.id+'"]').parents(".input-field-wrapper").length){var i="";$('input[name="'+t.id+'"]').siblings(".unit").length&&(i=" "+$('input[name="'+t.id+'"]').siblings(".unit").text()),a+="\n"+$.trim(t.label)+":"+t.value+i}else if(t.label&&t.value){var n="";t.note&&SUMMARY_SHOW_NOTES&&(n=" ("+t.note+")");var o=t.value;t.value.toString().indexOf(";base64,")&&(o=t.value.split("|")[0]),a+="\n"+$.trim(t.label)+": "+o+" "+n}}),t+=a}else if($("input#"+e.id).parents(".input-field-wrapper").length){var n="";$("input#"+e.id).siblings(".unit").length&&(n=" "+$("input#"+e.id).siblings(".unit").text()),t+=$.trim(e.label)+": "+e.value+n+"\n"}else if(e.label&&e.value){var o="";e.note&&SUMMARY_SHOW_NOTES&&(o=" ("+e.note+")");var s=e.value;e.value.toString().indexOf(";base64,")&&(s=e.value.split("|")[0]),t+=$.trim(e.label)+": "+s+" "+o+"\n"}}):t=EMPTY_SUMMARY_MESSAGE,$(".sgg_field_summary input").val(t),$(".sgg_field_summary textarea").val(t)}function _updateSummary(){var t=getConfiguratorOptionValues(),e=[];if(t.length){$(".staggs-summary-items").html("");var i=[];$(".staggs-summary-items").data("hidden")&&(i=$(".staggs-summary-items").data("hidden").toString().split(",").map(t=>$.trim(t))),t.forEach(function(t,a){if(!t.hidden&&!i.includes($.trim(t.label))){if(Array.isArray(t.value)){var n='<li class="summary-items-'+slugify(t.label)+'"><strong>'+t.label+":</strong>";t.value.forEach(function(t,e){if($('input[name="'+t.id+'"]').parents(".input-field-wrapper").length){var i="";$('input[name="'+t.id+'"]').siblings(".unit").length&&(i=" "+$('input[name="'+t.id+'"]').siblings(".unit").text()),n+="<br><p>"+$.trim(t.label)+":<span>"+t.value+i+"</span></p>"}else if(t.label&&t.value){var a="";t.note&&SUMMARY_SHOW_NOTES&&(a="<small>"+t.note+"</small>");var o=t.value;t.value.toString().indexOf(";base64,")&&(o=t.value.split("|")[0]),n+="<br><p>"+$.trim(t.label)+": <span>"+o+"</span> "+a+"</p>"}}),$(".staggs-summary-items").append(n)}else if($("input#"+t.id).parents(".input-field-wrapper").length){var o="";$("input#"+t.id).siblings(".unit").length&&(o=" "+$("input#"+t.id).siblings(".unit").text());var s=$.trim(t.label);$(".staggs-summary-items").append('<li class="summary-items-'+slugify(s)+'"><strong>'+s+":</strong> <p><span>"+t.value+o+"</span></p></li>")}else if(t.label&&t.value&&!$('input[name="'+t.name+'"]').data("title")){var s=$.trim(t.label),r="";t.note&&SUMMARY_SHOW_NOTES&&(r="<small>"+t.note+"</small>");var p=t.value;t.value.toString().indexOf(";base64,")&&(p=t.value.split("|")[0]),e.includes(s)?$(".staggs-summary-items").append('<li class="summary-items-'+slugify(s)+'"><p><span>'+p+"</span> "+r+"</p></li>"):$(".staggs-summary-items").append('<li class="summary-items-'+slugify(s)+'"><strong>'+s+":</strong> <p><span>"+p+"</span> "+r+"</p></li>"),SUMMARY_SINGLE_TITLE&&e.push(s)}}})}else $(".staggs-summary-items").html("<li>"+EMPTY_SUMMARY_MESSAGE+"</li>");$.event.trigger({type:"staggs_product_summary_updated"})}function _updateEmailBodySummary(t=""){var e=getConfiguratorOptionValues(),i=[],a=$("#staggs-send-email").attr("href").split("body=")[0]+"body=",n="";$("#staggs-send-email").data("title")&&(n=$("#staggs-send-email").data("title")+"%0D%0A"),$("#staggs-send-email").data("include_pdf")&&$("#staggs-send-email").addClass("sgg-generate-pdf"),e.length&&e.forEach(function(t,e){if($("input#"+t.id).parents(".input-field-wrapper").length){var a="";$("input#"+t.id).siblings(".unit").length&&(a=" "+$("input#"+t.id).siblings(".unit").text()),n+=$("input#"+t.id).parents(".input-field-wrapper").find(".input-title").text()+":%20"+t.value+a+"%0D%0A"}else if($('div[data-step="'+t.step_id+'"] .option-group-header').find(".title").text()){var o=t.value;t.value.toString().indexOf(";base64,")&&(o=t.value.split("|")[0]);var s=$('div[data-step="'+t.step_id+'"] .option-group-header').find(".title").text();i.includes(s)?n+=o+"%0D%0A":n+=s+":%20"+o+"%0D%0A",SUMMARY_SINGLE_TITLE&&i.push(s)}}),""!==t&&(n+="%0D%0A"+t),$("#staggs-send-email").attr("href",a+n)}function _updateProductPageDetails(){var t=$(".staggs-product-view .swiper-slide-active").html(),e=$(".woocommerce-product-gallery__wrapper").find(".woocommerce-product-gallery__image:first-of-type");if(e.length&&(e.html(t),$(".woocommerce-product-gallery__trigger").hide(),e.attr("data-thumb")&&e.attr("data-thumb","")),$(".entry-summary p.price").length&&!DISABLE_PRODUCT_PRICE_UPDATE){var i=getConfiguratorTotals();$(".entry-summary p.price").html(_formatPriceOutput(i,"",!0))}if($(".wd-single-price p.price").length&&!DISABLE_PRODUCT_PRICE_UPDATE){var i=getConfiguratorTotals();$(".wd-single-price p.price").html(_formatPriceOutput(i,"",!0))}$(".staggs-configure-product-button").parents("form").find(".single_add_to_cart_button").addClass("staggs-popup-cart-action"),$(".staggs-configurator-popup").removeClass("active"),$("body").removeClass("staggs-popup-active"),$(".staggs-message-wrapper").addClass("inline")}function _saveToWishlist(t,e){var i=JSON.stringify(t);wishlist_items.push(i);var a=e.find(".wishlist-icon").html();SGG_LOADER_ICON&&e.find(".wishlist-icon").html(SGG_LOADER_ICON),$.ajax({type:"post",url:AJAX_URL,data:{action:"staggs_save_wishlist_item_for_user",wishlist:wishlist_items},success:function(t){$(".woocommerce-notices-wrapper").html('<div class="woocommerce-message" role="alert"><a href="'+WISHLIST_PAGE_URL+'" class="button wc-forward">'+VIEW_WISHLIST_BUTTON_TEXT+"</a>"+WISHLIST_NOTICE_MESSAGE+'<a href="#0" class="hide-notice"></a></div>'),$(".staggs-message-wrapper").addClass("active"),noticeTimeout&&clearTimeout(noticeTimeout),noticeTimeout=setTimeout(function(){$(".staggs-message-wrapper").removeClass("active"),$(".staggs-message-wrapper").find(".woocommerce-notices-wrapper").html("")},12e3),e.find(".wishlist-icon").html(a)}})}function _saveAndShowSummary(t){var e=JSON.stringify(t);$.ajax({type:"post",url:AJAX_URL,data:{action:"staggs_save_configuration_to_file",contents:e},success:function(t){var e=JSON.parse(t),i=window.location.origin+window.location.pathname,a="?staggs_summary="+e.filename;window.location=i+a}})}$(document).bind("input",".option-group-options.measurements input[type=number]",function(t){var e=$(t.target);if(e.parents(".measurements").length){var i=e.attr("name");e.parents(".measurements").find("input[type=hidden]").length&&(i=e.parents(".option-group-options").find("input[type=hidden]").attr("id")),e.parents(".option-group-options").data("price-key")&&(i=e.parents(".option-group-options").data("price-key").toString());var a=e.parents(".option-group").data("step");clearTimeout(timer),e.parents(".option-group").hasClass("sgg-init")?(_updateMeasurementPrices(e),_recalculateMeasurementPricings(e,i,a),e.parents(".option-group").removeClass("sgg-init")):timer=setTimeout(function(){_updateMeasurementPrices(e),_recalculateMeasurementPricings(e,i,a)},delay)}}),$(document).on("input",".text-input input[data-preview-index], .text-input textarea[data-preview-index], .measurements input[data-preview-index]",function(){_syncTextInputs($(this))}),$(document).on("input",".image-input input",function(){_syncImageInputs(this),$(".staggs-summary-widget").length&&_updateSummary(),$(".sgg_field_summary").length&&_updateFormFieldSummary(),$("#staggs-send-email").length&&_updateEmailBodySummary()}),$(document).on("click",".image-input .remove-input-image",function(){var t=$(this).parents(".image-input-field").find("input[type=hidden]").val(),e=$(this).parents(".image-input-field").find("input[type=file]").get(0),i=t.split(".").at(-1);if(e.files[0]&&!_isImageFile(e.files[0])||t&&!_isImageExt(i)){var a=$(this);$.ajax({type:"post",url:AJAX_URL,data:{action:"staggs_clear_uploaded_file",details:t},success:function(t){a.parents(".image-input-field").find("input[type=hidden]").val("")},error:function(t){console.error("Could not delete file")}})}if($('.image-input-field input[data-field-key="'+$(this).data("delete")+'"]').length){var n=$('.image-input-field input[data-field-key="'+$(this).data("delete")+'"]');_removeImageInput(n)}if($('.image-input-field input[data-material-key="'+$(this).data("delete")+'"]').length){var n=$('.image-input-field input[data-material-key="'+$(this).data("delete")+'"]');_removeImageInput(n)}if($('.image-input-field input[data-step-id="'+$(this).data("delete")+'"]').length){var n=$('.image-input-field input[data-step-id="'+$(this).data("delete")+'"]');_removeImageInput(n)}$(".staggs-summary-widget").length&&_updateSummary(),$(".sgg_field_summary").length&&_updateFormFieldSummary(),$("#staggs-send-email").length&&_updateEmailBodySummary()}),$(document).on("click",".option-group-options.products input[type=number]",function(){$(this).select()}),$(document).on("input",".option-group-options.products input[type=number]",function(){var t,e=$(this).attr("id"),i=$(this).data("preview-urls"),a=$(this).parents(".option-group").data("preview-order"),n=$(this).val()?parseInt($(this).val()):0,o=$(this).attr("max")?parseInt($(this).attr("max")):null;if(o&&(n>o?$(this).addClass("invalid"):($(this).removeClass("invalid"),$(this).parents(".option-group").find(".sgg-error").remove())),n>0?$(this).parents(".sgg-product").addClass("selected"):$(this).parents(".sgg-product").removeClass("selected"),$(this).data("price")&&(t=parseFloat($(this).data("price"))),i&&n>0?($(this).data("order")&&(a=$(this).data("order")),_buildPreviewGallery(i,e,a)):_deletePreviewGallery(i,e),($(this).attr("required")||$(this).val())&&($(this).parents(".option-group").data("shared-min")||$(this).parents(".option-group").data("shared-max"))){var s=0;$(this).parents(".option-group").find("input[type=number]").each(function(t,e){s+=parseInt($(e).val())}),$(this).parents(".option-group").find("input[type=checkbox]:checked").each(function(t,e){s++}),_validateSharedFieldTotals($(this),s)}t&&(n>0?(pricetotal[e]=t*n,altpricetotal[e]=parseFloat($(this).data("alt-price"))*n):(delete pricetotal[e],delete altpricetotal[e])),_setTotals()}),$(document).on("change",".option-group-options.products input[type=checkbox]",function(){var t,e=$(this).attr("id"),i=$(this).data("preview-urls"),a=$(this).parents(".option-group").data("preview-order"),n=$(this).val();if($(this).data("price")&&(t=parseFloat($(this).data("price"))),$(this).is(":checked")?$(this).parents(".sgg-product").addClass("selected"):$(this).parents(".sgg-product").removeClass("selected"),i&&$(this).is(":checked")?($(this).data("order")&&(a=$(this).data("order")),_buildPreviewGallery(i,e,a)):_deletePreviewGallery(i,e),($(this).attr("required")||$(this).val())&&($(this).parents(".option-group").data("shared-min")||$(this).parents(".option-group").data("shared-max"))){var o=0;$(this).parents(".option-group").find("input[type=number]").each(function(t,e){o+=parseInt($(e).val())}),$(this).parents(".option-group").find("input[type=checkbox]:checked").each(function(t,e){o++}),_validateSharedFieldTotals($(this),o)}t&&($(this).is(":checked")?(pricetotal[e]=t*n,altpricetotal[e]=parseFloat($(this).data("alt-price"))*n):(delete pricetotal[e],delete altpricetotal[e])),_setTotals()}),$.fn.isInViewport=function(){var t=$(this).offset().top,e=t+$(this).outerHeight(),i=$(window).scrollTop(),a=i+$(window).height();return e>i&&t<a},$(".staggs-configurator-sticky-bar").length&&$(window).on("resize scroll",function(){$(".staggs-product-options form.cart .single_add_to_cart_button").length&&($(".staggs-product-options form.cart .single_add_to_cart_button").isInViewport()?$(".staggs-configurator-sticky-bar").removeClass("active"):$(".staggs-configurator-sticky-bar").addClass("active"))}),$(document).on("click",".staggs-cart-form-button #staggs-send-email[data-include_pdf]",function(t){var e=$(this);if($(this).hasClass("sgg-generate-pdf")){var i=renderFinalProductImage();i.isPromise?i.image.then(function(t){_clearProductBackgroundImage(),processComplexEmailButton(e,t)}):processComplexEmailButton(e,i.image)}}),$(document).on("click",".staggs-cart-form-button #staggs-send-email",function(t){if($(this).hasClass("sgg-generate-pdf"))return!1;let e=!0;return($("#configurator-options input[required], #configurator-options select[required], #configurator-options textarea[required]").each(function(){"radio"===$(this).attr("type")?$(this).parents(".option-group-options").find("input:checked").length?($(this).parents(".option-group").removeClass("invalid"),$(this).parents(".option-group").find(".sgg-error").remove()):($(this).parents(".option-group").addClass("invalid"),e=!1):"checkbox"===$(this).attr("type")?$(this).parents(".option-group-options").find("input:checked").length?($(this).parents(".option-group").removeClass("invalid"),$(this).parents(".option-group").find(".sgg-error").remove()):($(this).parents(".option-group").addClass("invalid"),e=!1):$(this).val()||($(this).addClass("invalid"),e=!1)}),e)?$("#configurator-options .invalid").length?(SINGLE_ERROR_MESSAGE?alert(INVALID_MESSAGE):($("#configurator-options .invalid").parents(".option-group").length&&!$("#configurator-options .invalid").parents(".option-group").find(".sgg-error").length&&$("#configurator-options .invalid").parents(".option-group").append('<small class="sgg-error">'+INVALID_FIELD_MESSAGE+"</small>"),$("#configurator-options .invalid .option-group-content .sgg-error").length||$("#configurator-options .invalid .option-group-content").append('<small class="sgg-error">'+REQUIRED_FIELD_MESSAGE+"</small>")),$(".sgg-error").length&&$("html, body").animate({scrollTop:$(".sgg-error").offset().top-300},500),!1):void 0:(SINGLE_ERROR_MESSAGE?alert(REQUIRED_MESSAGE):($("#configurator-options .invalid").parents(".option-group").length&&!$("#configurator-options .invalid").parents(".option-group").find(".sgg-error").length&&$("#configurator-options .invalid").parents(".option-group").append('<small class="sgg-error">'+REQUIRED_FIELD_MESSAGE+"</small>"),$("#configurator-options .invalid .option-group-content .sgg-error").length||$("#configurator-options .invalid .option-group-content").append('<small class="sgg-error">'+REQUIRED_FIELD_MESSAGE+"</small>")),$(".sgg-error").length&&$("html, body").animate({scrollTop:$(".sgg-error").offset().top-300},500),!1)}),$(document).on("click",".staggs-configurator-sticky-bar .single_add_to_cart_button",function(t){t.preventDefault(),$(".staggs-configurator-main").find("form.cart .single_add_to_cart_button").click()}),$(".staggs-cart-form-button .single_add_to_cart_button").off("click").on("click",function(t){if(!$(this).parents("form.cart").find(".staggs-configure-product-button").length||$(this).hasClass("staggs-popup-cart-action")){t.preventDefault();var e=$(this);if($(this).parents(".staggs-summary-total-buttons").length){var i={action:"add_product_to_cart",product_id:shared_config.product,options:shared_config.values,product_price:shared_config.total},a=_getConfiguratorQuantity();a&&(i.quantity=a),CAPTURE_PREVIEW_IMAGE&&(i.product_image=shared_config.image),processCartForm(e,i)}else{if(POPUP_UPDATE_PAGE&&$(this).parents(".staggs-configurator-popup").length){_updateProductPageDetails();return}if(!_validateConfiguratorForm())return!1;$(".staggs-product-options").addClass("loading");for(var n=$("body").find("form.cart").serializeArray(),o=getConfiguratorOptionValues(),s=getConfiguratorTotals(),i={action:"add_product_to_cart",options:o,product_price:s},r=0;r<n.length;r++)-1!==n[r].name.indexOf("[]")?i[n[r].name]?i[n[r].name].push(n[r].value):i[n[r].name]=[n[r].value]:i[n[r].name]=n[r].value;var a=_getConfiguratorQuantity();if(a&&(i.quantity=a),CAPTURE_PREVIEW_IMAGE){var p=renderFinalProductImage();p.isPromise?p.image.then(function(t){i.product_image=t,_clearProductBackgroundImage(),processCartForm(e,i)}):(i.product_image=p.image,processCartForm(e,i))}else processCartForm(e,i)}return!1}}),$("body").on("added_to_cart",function(t,e,i){"no"===REDIRECT_TO_CART?$(".staggs-message-wrapper").length?($(".woocommerce-error, .woocommerce-message, .woocommerce-info").remove(),$(".staggs-message-wrapper").find(".woocommerce-notices-wrapper").html(e.notices_html),$(".staggs-message-wrapper").addClass("active"),$(document).find(".staggs-message-wrapper .woocommerce-message").append('<a href="#0" class="hide-notice"></a>'),noticeTimeout&&clearTimeout(noticeTimeout),noticeTimeout=setTimeout(function(){$(".staggs-message-wrapper").removeClass("active"),$(".staggs-message-wrapper").find(".woocommerce-notices-wrapper").html("")},12e3)):$("body").find(".woocommerce-notices-wrapper").html(e.notices_html):window.location.href=CART_URL}),$(document).on("click","#staggs-show-summary",function(t){if(t.preventDefault(),POPUP_UPDATE_PAGE&&$(this).parents(".staggs-configurator-popup").length){_updateProductPageDetails();return}if(!_validateConfiguratorForm())return!1;var e={product:$(this).data("product"),values:[],image:"",progress:"",total:""};e.values=getConfiguratorOptionValues(),e.total=getConfiguratorTotals(),$(".option-group-step-buttons").length&&$(".option-group-step").length>1&&(e.progress={current:activeStep,visited:visitedStep,max:maxStep}),$("#preview_slide_0").length?modernScreenshot.domToPng(document.getElementById("preview_slide_0")).then(function(t){e.image=t,_saveAndShowSummary(e)}).catch(function(t){console.error("oops, something went wrong!",t)}):$(".staggs-view-gallery model-viewer").length&&(e.image=document.getElementById("product-model-view").toDataURL(),_saveAndShowSummary(e))}),$("#request-invoice button, #invoice button").on("click",function(t){if(t.preventDefault(),"download_pdf"!==$(this).attr("id")){if(POPUP_UPDATE_PAGE){_updateProductPageDetails();return}if(!_validateConfiguratorForm())return!1;$(".staggs-product-options").addClass("loading");var e,i=$(this),a=renderFinalProductImage();a.isPromise?a.image.then(function(t){_clearProductBackgroundImage(),processForm(i,t)}):processForm(i,a.image)}}),$("#request-invoice #download_pdf, #invoice #download_pdf, .preview-action.download-pdf").on("click",function(t){if(t.preventDefault(),!_validateConfiguratorForm())return!1;$(".staggs-product-options").addClass("loading");var e=$(this),i=renderFinalProductImage();i.isPromise?i.image.then(function(t){_clearProductBackgroundImage(),processPdfForm(e,t)}):processPdfForm(e,i.image)}),$("#staggs_pdf_invoice").on("submit",function(t){if(t.preventDefault(),POPUP_UPDATE_PAGE){_updateProductPageDetails();return}var e=_validateConfiguratorForm();if(!e)return e;var i="";if($(this).find('input[name="generate_pdf_email"]').length){""===$(this).find('input[name="generate_pdf_email"]').val()&&($(this).find('input[name="generate_pdf_email"]').addClass("invalid"),e=!1);let a=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;(e=a.test(String($(this).find('input[name="generate_pdf_email"]').val()).toLowerCase()))&&(i=$(this).find('input[name="generate_pdf_email"]').val())}if(!e)return SINGLE_ERROR_MESSAGE?alert(REQUIRED_MESSAGE):$("#configurator-options .invalid").parents(".option-group").find(".sgg-error").length||$("#configurator-options .invalid").parents(".option-group").append('<small class="sgg-error">'+REQUIRED_FIELD_MESSAGE+"</small>"),!1;$(".staggs-product-options").addClass("loading");var n=$(this),o=renderFinalProductImage();o.isPromise?o.image.then(function(t){_clearProductBackgroundImage(),processPdfForm(n,t,i)}):processPdfForm(n,o.image,i)}),$(document).on("click",".staggs-summary-template .staggs-back-configurator",function(t){if(t.preventDefault(),$(this).parents(".staggs-inline-page-summary").length)$(this).parents(".staggs-inline-page-summary").addClass("hidden"),$(this).parents(".staggs-product-options").find(".option-group-wrapper").removeClass("hidden");else{if($(".staggs-summary-template").remove(),$(".staggs-configurator-main").removeClass("summary-visible"),$(".staggs-configurator-steps-nav").length){stepNavSwiper=new Swiper(".staggs-configurator-steps-nav",{slidesPerView:"auto",initialSlide:0,spaceBetween:10});var e=0;$(".staggs-configurator-steps-nav").find(".swiper-slide").each(function(t,i){e+=$(i).width()}),e<$(".staggs-configurator-steps-nav").width()&&$(".staggs-configurator-steps-nav").find(".swiper-wrapper").addClass("centered")}$(".staggs-configurator-main .swiper-options-nav").length&&(optionNavSwiper=new Swiper(".swiper-options-nav",{slidesPerView:"auto",initialSlide:0,spaceBetween:10}))}var i=window.location.origin+window.location.pathname;window.history.pushState("","",i)}),$(document).on("click",".staggs-preview-actions button.wishlist-toggle",function(t){t.preventDefault();var e=$(this),i={product:$(this).data("product"),values:[],image:"",progress:"",total:""};i.values=getConfiguratorOptionValues(),i.total=getConfiguratorTotals(),$(".option-group-step-buttons").length&&$(".option-group-step").length>1&&(i.progress={current:activeStep,visited:visitedStep,max:maxStep}),$("#preview_slide_0").length?modernScreenshot.domToPng(document.getElementById("preview_slide_0")).then(function(t){i.image=t,_saveToWishlist(i,e)}).catch(function(t){console.error("oops, something went wrong!",t)}):$(".staggs-view-gallery model-viewer").length&&(i.image=document.getElementById("product-model-view").toDataURL(),_saveToWishlist(i,e))}),$("#save-configuration button, .staggs-preview-actions button.share-link").on("click",function(t){t.preventDefault();var e="",i=$(this);$(this).find(".link-icon").length&&SGG_LOADER_ICON&&(e=$(this).find(".link-icon").html(),$(this).find(".link-icon").html(SGG_LOADER_ICON));var a={values:[],progress:""};a.values=getConfiguratorOptionValues(),$(".option-group-step-buttons").length&&$(".option-group-step").length>1&&(a.progress={current:activeStep,visited:visitedStep,max:maxStep});var n=JSON.stringify(a);$.ajax({type:"post",url:AJAX_URL,data:{action:"staggs_save_configuration_to_file",contents:n},success:function(t){var a=JSON.parse(t),n=window.location.origin+window.location.pathname,o="?configuration="+a.filename;$(".staggs-message-wrapper").length?($(".staggs-message-wrapper").find(".woocommerce-notices-wrapper").html('<div class="woocommerce-message" role="alert"><a href="'+n+o+'" tabindex="1" id="copylink" class="button wc-forward">'+COPY_NOTICE_BUTTON_TEXT+"</a>"+COPY_NOTICE_MESSAGE+'<a href="#0" class="hide-notice"></a></div>'),$(".staggs-message-wrapper").addClass("active")):$(".woocommerce-notices-wrapper").html('<div class="woocommerce-message" role="alert"><a href="'+n+o+'" tabindex="1" id="copylink" class="button wc-forward">'+COPY_NOTICE_BUTTON_TEXT+"</a>"+COPY_NOTICE_MESSAGE+'<a href="#0" class="hide-notice"></a></div>'),noticeTimeout&&clearTimeout(noticeTimeout),noticeTimeout=setTimeout(function(){$(".staggs-message-wrapper").removeClass("active"),$(".staggs-message-wrapper").find(".woocommerce-notices-wrapper").html("")},12e3),i.find(".link-icon").length&&SGG_LOADER_ICON&&i.find(".link-icon").html(e)}})}),$(document).on("click",".staggs-summary-template #download-summary-pdf",function(t){t.preventDefault();var e={product_id:shared_config.product,configuration:shared_config.values,product_image:shared_config.image,product_price:shared_config.total};$.ajax({type:"post",url:AJAX_URL,data:{action:"staggs_download_configuration_pdf",pdf:e},success:function(t){let e=t,i=e.file.split(",")[1],a=atob(i),n=new Uint8Array(a.length);for(let o=0;o<a.length;o++)n[o]=a.charCodeAt(o);let s=new Blob([n],{type:"application/pdf"}),r=URL.createObjectURL(s),p=document.createElement("a");p.href=r,p.download=e.file_name,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(r),$(".staggs-product-options").removeClass("loading")}})}),$(".staggs-preview-actions button.reset-toggle").on("click",function(t){t.preventDefault();var e="";$(this).find(".reset-icon").length&&SGG_LOADER_ICON&&(e=$(this).find(".reset-icon").html(),$(this).find(".reset-icon").html(SGG_LOADER_ICON)),$(".option-group input").each(function(t,e){if($(e).parents(".option-group").data("price-key"))var i=$(e).parents(".option-group").data("price-key").toString();else var i=$(e).attr("name");if($(e).parents(".image-input-field").length)$(e).parents(".image-input-field").find(".remove-input-image").trigger("click");else if("radio"===$(e).attr("type")||"checkbox"===$(e).attr("type")){var a=!1;$(e).data("default")&&(a=!0),$(e).prop("checked",a),$(e).attr("checked",a),$(e).trigger("change"),!a&&$(e).parents(".option-group-content").find(".option-group-summary").length&&($(e).parents(".option-group-content").find(".option-group-summary .name").text(""),$(e).parents(".option-group-content").find(".option-group-summary .value").text(""))}else{var a="";$(e).data("default")&&(a=$(e).data("default")),$(e).val(a),$(e).trigger("input")}pricetotal[i]&&(delete pricetotal[i],delete altpricetotal[i]);var n=$(this).attr("name");"checkbox"===$(this).attr("type")&&(n=$(this).attr("id")),TRACK_GLOBAL_OPTIONS&&sessionStorage.getItem(PRODUCT_ID+"_sgg_"+n+"_option")&&sessionStorage.removeItem(PRODUCT_ID+"_sgg_"+n+"_option")}),$(".option-group select").each(function(t,e){if($(e).find("option[data-default]").length)var i=$(e).find("option[data-default]");else var i=$(e).find("option:not(:disabled):first-of-type");$(e).find("option").prop("selected",!1),$(i).attr("value")?$(e).val($(i).attr("value")):$(e).val(""),$(e).trigger("change"),$(e).next(".ui-selectmenu-button").length&&$(e).selectmenu("refresh",!0);var a=$(this).attr("name");TRACK_GLOBAL_OPTIONS&&sessionStorage.getItem(PRODUCT_ID+"_sgg_"+a+"_option")&&sessionStorage.removeItem(PRODUCT_ID+"_sgg_"+a+"_option")}),minStep=1,activeStep=1,visitedStep=1,_setActiveStep(),$(".staggs-view-gallery .staggs-view-gallery__image").length&&$(".staggs-view-gallery .staggs-view-gallery__image").each(function(t,e){$(e).find("img").attr("src",$(e).data("base-url")),$(e).find("img").attr("id",$(e).data("base-id"))}),$(".option-group .option-group-options").length&&$(".option-group .option-group-options").each(function(t,e){setActiveStepOptions(e)}),$(".option-group-options input[data-type=range]").length&&$(".option-group-options input[data-type=range]").each(function(t,e){_initRangeSlider($(e))}),$(".option-group-options input[data-preview-index]").length&&$(".option-group-options input[data-preview-index]").each(function(t,e){"file"!==$(e).attr("type")&&_syncTextInputs($(e))}),_setTotals(),$(this).find(".reset-icon").length&&SGG_LOADER_ICON&&$(this).find(".reset-icon").html(e)}),$(document).on("click",".staggs-summary-template .share-link",function(t){t.preventDefault(),$(this).siblings("input").select(),$(this).siblings("input").focus(),document.execCommand("copy")}),$(document).on("click",".staggs-message-wrapper .hide-notice",function(){$(".staggs-message-wrapper").removeClass("active"),$(".staggs-message-wrapper").find(".woocommerce-notices-wrapper").html(""),clearTimeout(noticeTimeout)}),$(document).on("click","#copylink",function(t){t.preventDefault();var e=$("<input>"),i=$(t.target).attr("href");$("body").append(e),e.val(i).select(),document.execCommand("copy"),e.remove(),$(t.target).text(COPY_NOTICE_BUTTON_COPIED)}),$(document).on("input",".option-group.total input.qty",function(){$('.option-group-options[data-table-x="quantity"]').length&&_recalculateMeasurementPricings($(this),"quantity",999999),$('.option-group-options[data-table-y="quantity"]').length&&_recalculateMeasurementPricings($(this),"quantity",999999),$('.option-group-options[data-formula*="quantity"]').length&&$('.option-group-options[data-formula*="quantity"]').each(function(t,e){$(e).find("input").trigger("input")}),_setTotals()});var _getSelectMenuOptions=function(){return{position:{my:"left top",at:"left bottom",collision:"flip",using:function(t,e){"top"!=e.vertical?($(this).addClass("flipped"),$(e.target.element[0]).addClass("flipped")):($(this).removeClass("flipped"),$(e.target.element[0]).removeClass("flipped")),$(this).css({left:t.left+"px",top:t.top+"px"})}},change:function(t,e){$(t.target).trigger("change")}}},_selectMenuItemRenderer=function(t,e){var i=$("<li>");if(e.disabled&&i.addClass("ui-state-disabled"),$(e.element[0]).hasClass("hidden"))return t;var a=$("<div>"+e.label+"</div>");return $(e.element[0]).attr("style")&&(a.attr("style",$(e.element[0]).attr("style").replaceAll(";;",";")),$(e.element[0]).data("input-key")&&_updatePreviewTextFont($(e.element[0]))),i.append(a).appendTo(t)},_selectMenuButtonRenderer=function(t){var e=$("<span>",{class:"ui-selectmenu-text"});return this._setText(e,t.label),$(t.element[0]).attr("style")&&(e.attr("style",$(t.element[0]).attr("style").replaceAll(";;",";")),$(t.element[0]).data("input-key")&&_updatePreviewTextFont($(t.element[0]))),e};function _resizeTextToFit(t,e,i){var a=parseInt(t.find("span").css("font-size")),n=0;if(t.find(".preview-text-input").each(function(t,e){""!==$(e).text()&&n++}),"none"!==t.css("maxHeight")&&n>0){t.css("height",t.css("maxHeight")),e=Math.floor(parseInt(t.css("height"))/n);var o=parseFloat(t.css("lineHeight"))/parseFloat(t.css("fontSize"));e=Math.floor(e/o),t.find("span").css("font-size",e),t.find(".preview-text-input").each(function(e,i){if(""===$(i).text()){$(i).addClass("hidden");return}for($(i).removeClass("hidden");$(i).find("span").width()>t.width();)a=parseInt(t.find("span").css("font-size")),t.find("span").css("font-size",a-1)})}else t.attr("style")&&t.attr("style").includes("width")&&t.find(".preview-text-input").each(function(i,n){if(""!==$(n).text()){if($(n).find("span").width()>t.width())for(;$(n).find("span").width()>t.width();)a=parseInt(t.find("span").css("font-size")),t.find("span").css("font-size",a-1);else if($(n).find("span").width()<t.width()&&a<e)for(;$(n).find("span").width()<t.width()&&a<e;)a=parseInt(t.find("span").css("font-size")),t.find("span").css("font-size",a+1)}})}function _formatPriceOutput(t,e="",i=!1){var a,n=parseFloat(t);a=(n=n.toFixed(NUMBER_OF_DECIMALS)).toString().replace(".",DECIMAL_SEPARATOR),THOUSAND_SEPARATOR.length>0&&(a=_addThousandSep(a));var o=!1;return n<0&&(a=a.substring(1),o=!0),TRIM_PRICE_DECIMALS&&(a=a.replace(DECIMAL_SEPARATOR+"00",DECIMAL_SEPARATOR+"-")),"right"==CURRENCY_POS?a+=CURRENCY_SYMBOL:a="right_space"==CURRENCY_POS?a+" "+CURRENCY_SYMBOL:"left_space"==CURRENCY_POS?CURRENCY_SYMBOL+" "+a:CURRENCY_SYMBOL+a,i||o||0==t||(a='<span class="sign">'+PRODUCT_PRICE_SIGN+"</span>"+a),o&&(a="-"+a),'<span class="amount">'+a+"</span>"+e}function _addThousandSep(t){var e=/(\d+)(\d{3})/;return String(t).replace(/^\d+/,function(t){for(;e.test(t);)t=t.replace(e,"$1"+THOUSAND_SEPARATOR+"$2");return t})}function _isImageExt(t){let e=["jpeg","jpg","png","webp","gif","tiff","bmp","eps","svg","ico","heif","heic"];return e.includes(t)}function _isImageFile(t){let e=t.type,i=["image/jpeg","image/png","image/webp","image/gif","image/eps","image/ico","image/tiff","image/bmp","image/svg+xml","image/heif","image/heic"];return i.includes(e)}function _captureAndDownloadImage(){if($("#preview_slide_0").length)modernScreenshot.domToPng(document.getElementById("preview_slide_0")).then(function(t){var e="capture",i=document.createElement("a");i.style.display="none",document.body.appendChild(i),i.href=t,i.download=e+".png",i.click(),window.setTimeout(()=>{document.body.removeChild(i)},100)}).catch(function(t){console.error("oops, something went wrong!",t)});else if($(".staggs-view-gallery model-viewer").length){var t=document.getElementById("product-model-view").toDataURL(),e="capture",i=document.createElement("a");i.style.display="none",document.body.appendChild(i),i.href=t,i.download=e+".png",i.click(),window.setTimeout(()=>{document.body.removeChild(i)},100)}}function _updateOptionMaterialCanvas(t,e){if($('.option-group-canvas[data-key="'+t+'"]').length){var i=$('.option-group-canvas[data-key="'+t+'"]').attr("id");if(sgg_canvasses.hasOwnProperty(i)){var a=_getCanvasObjectById(i.replace("_canvas",""),i);if(a.length){for(var n in e)a[0].set(n,e[n]);sgg_canvasses[i].renderAll();var o=sgg_canvasses[i].toDataURL(),s=$('.option-group-canvas[data-key="'+t+'"]').closest(".option-group").data("model");s||(s=$('.option-group-canvas[data-key="'+t+'"]').closest(".option-group").find("input").data("material-key"));var r=$('.option-group-canvas[data-key="'+t+'"]').closest(".option-group").data("model-material");r||(r="base"),$.event.trigger({type:"modelMaterialChanged",model:s,channel:r,texture:o})}}}}function _getCanvasObjectById(t,e=1){return void 0!==sgg_canvasses&&sgg_canvasses[e]?sgg_canvasses[e].getObjects().filter(e=>e.id===t):{}}function slugify(t){return t=(t=(t=t.replace(/^\s+|\s+$/g,"")).toLowerCase()).replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}function exitHandler(){document.fullscreenElement||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||$(".staggs-preview-actions button.fullscreen").removeClass("active")}function toggleFullScreen(t){return t||(t=document.body),document.fullScreenElement&&null!==document.fullScreenElement||document.mozFullScreen||document.webkitIsFullScreen?($(".staggs-preview-actions button.fullscreen").removeClass("active"),cancelFullScreen()):($(".staggs-preview-actions button.fullscreen").addClass("active"),requestFullScreen(t)),!1}function cancelFullScreen(){var t=document,e=t.cancelFullScreen||t.webkitCancelFullScreen||t.mozCancelFullScreen||t.exitFullscreen||t.webkitExitFullscreen;if(e)e.call(t);else if(void 0!==window.ActiveXObject){var i=new ActiveXObject("WScript.Shell");null!==i&&i.SendKeys("{F11}")}}function requestFullScreen(t){var e=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullscreen;if(e)e.call(t);else if(void 0!==window.ActiveXObject){var i=new ActiveXObject("WScript.Shell");null!==i&&i.SendKeys("{F11}")}return!1}document.addEventListener("fullscreenchange",exitHandler),document.addEventListener("webkitfullscreenchange",exitHandler),document.addEventListener("mozfullscreenchange",exitHandler),document.addEventListener("MSFullscreenChange",exitHandler),window.staggsGetTotalConfigurationImage=function t(){return renderFinalProductImage()},window.staggsGetTotalConfigurationPrice=function t(){return getConfiguratorTotals()},window.staggsGetTotalConfigurationOptions=function t(){return getConfiguratorOptionValues()},jQuery.staggsSyncTextInputs=function t(e,i=""){_syncTextInputs(e,i)}}(jQuery);